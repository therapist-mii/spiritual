<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>色彩心理からのおすすめメニュー診断サイト</title>
    <!-- ファビコン設定 -->
    <link rel="icon" href="https://github.com/therapist-mii/spiritual/raw/main/images/favicon.png" type="image/png">
    
    <!-- Tailwind CSS CDNを読み込み -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Noto Serif JP の読み込み -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* カスタムスタイルと指定配色 */
        :root {
            --color-primary: #544C40; /* ダークブラウン/グレー */
            --color-secondary: #ede1e1; /* ライトベージュ/グレー */
            --color-accent: #E4C1B5; /* ロージーベージュ */
            --color-light: #EAE6E1; /* 非常に明るいベージュ */
        }
        body {
            font-family: 'Noto Serif JP', serif;
            background-color: var(--color-light);
            color: var(--color-primary);
        }
        .header-bg {
            background-color: var(--color-primary);
        }
        .main-bg {
            background-color: var(--color-secondary);
        }
        .diagnosis-button {
            background-color: var(--color-primary);
            color: var(--color-secondary);
            transition: background-color 0.2s, transform 0.2s;
        }
        .diagnosis-button:hover {
            background-color: #6B5D50;
            transform: translateY(-1px);
        }
        .selected-color-card {
            box-shadow: 0 0 0 4px var(--color-accent); /* 選択時のアクセントカラー枠 */
            transform: scale(1.05);
            transition: all 0.2s ease;
        }
        .clear-button {
            background-color: var(--color-accent);
            color: var(--color-primary);
        }
        .clear-button:hover {
            background-color: #D3A79A;
        }
        .footer-bg {
            background-color: var(--color-primary);
        }

        /* トーストメッセージ用スタイル */
        .toast {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            opacity: 0;
            transform: translateY(20px);
        }
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* 診断結果のカードデザイン */
        .result-card {
            border: 2px solid var(--color-accent);
            background-color: #ffffff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* メニュー詳細・予約ボタン */
        .action-button {
            transition: background-color 0.2s;
        }
        .action-button-detail {
            background-color: var(--color-accent);
        }
        .action-button-detail:hover {
            background-color: #D3A79A;
        }
        .action-button-booking {
            background-color: var(--color-primary);
            color: var(--color-secondary);
        }
        .action-button-booking:hover {
            background-color: #6B5D50;
        }
    </style>
</head>
<body>

    <!-- ヘッダー -->
    <header class="header-bg text-white shadow-lg sticky top-0 z-10">
        <div class="max-w-4xl mx-auto py-4 px-4">
            <h1 class="text-xl font-bold text-center">色彩心理からのおすすめメニュー診断サイト</h1>
        </div>
    </header>

    <!-- メインコンテンツ -->
    <main class="max-w-4xl mx-auto p-4 md:p-8">

        <!-- 診断エリア -->
        <div class="main-bg p-6 rounded-xl shadow-xl">
            <h2 class="text-lg font-bold mb-4 border-b border-gray-400 pb-2">ステップ１：気になる色を選ぶ</h2>
            
            <!-- 案内文 -->
            <p class="text-sm md:text-base mb-4 bg-yellow-50 text-gray-700 p-3 rounded-lg border border-yellow-200">
                <strong>色を気になる順に3色選んでください。</strong>
                <span class="block mt-1">選んだ色をもう一度タップすると解除できます。</span>
            </p>

            <!-- 選択された色パレット -->
            <div id="selectedPalette" class="flex justify-start items-center p-3 mb-6 space-x-3 rounded-lg border-2 border-dashed border-gray-400 min-h-16">
                <!-- 選択された色カードがここに入る -->
                <p id="selectionHint" class="text-gray-500 italic text-sm">現在 0/3 色選択中</p>
            </div>

            <!-- 操作ボタン -->
            <div class="flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-4 mb-8">
                <button id="clearSelection" class="clear-button py-2 px-6 rounded-full font-bold text-sm shadow-md transition duration-200" disabled>
                    選んだ色を消す (リセット)
                </button>
                <button id="diagnoseButton" class="diagnosis-button py-2 px-8 rounded-full font-bold text-sm shadow-lg transition duration-200" disabled>
                    メニュー診断する
                </button>
            </div>

            <!-- カラーパレット（モバイル横6列対応） -->
            <h3 class="text-lg font-bold mb-4">カラーカード一覧 (全37色)</h3>
            <div id="colorPalette" class="grid grid-cols-6 sm:grid-cols-8 md:grid-cols-10 lg:grid-cols-12 gap-2 max-h-[300px] overflow-y-auto p-2 border border-gray-300 rounded-lg">
                <!-- 色カードがJavaScriptによってここに生成される -->
            </div>
        </div>

        <!-- 診断結果エリア -->
        <div id="resultArea" class="mt-8 hidden p-6 result-card rounded-xl">
            <h2 class="text-2xl font-bold text-center text-red-700 mb-6 border-b border-gray-300 pb-3">診断結果</h2>
            
            <div class="space-y-6">
                <!-- 総合メッセージ -->
                <div>
                    <h3 class="text-xl font-bold mb-2 p-2 rounded-t-lg text-white" style="background-color: var(--color-primary);">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2 align-text-bottom" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M10 2a8 8 0 100 16 8 8 0 000-16zM6 10a4 4 0 118 0 4 4 0 01-8 0z" />
                        </svg>
                        色彩心理からの総合メッセージ
                    </h3>
                    <p id="combinedMessage" class="whitespace-pre-wrap text-base leading-relaxed p-4 border border-gray-200 rounded-b-lg"></p>
                </div>

                <!-- おすすめメニュー -->
                <div>
                    <h3 class="text-xl font-bold mb-2 p-2 rounded-t-lg text-white" style="background-color: var(--color-primary);">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2 align-text-bottom" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-7-9a1 1 0 011-1h2.586l.207-.207A7 7 0 0110 3.293V4a1 1 0 012 0v-.707a7 7 0 013.207 3.207l.207.207H16a1 1 0 010 2h-.586l-.207.207A7 7 0 0112 15.293V16a1 1 0 01-2 0v-.707a7 7 0 01-3.207-3.207l-.207-.207H4a1 1 0 01-1-1zM9 9a1 1 0 000 2h2a1 1 0 100-2H9z" clip-rule="evenodd" />
                        </svg>
                        一番おすすめのメニュー
                    </h3>
                    <p id="recommendedMenu" class="text-2xl font-extrabold text-center py-3" style="color: var(--color-primary);"></p>
                </div>
                
                <!-- おすすめ理由 -->
                <div class="p-4 border border-gray-300 rounded-lg bg-gray-50">
                    <h4 class="text-lg font-bold mb-2 text-center" style="color: var(--color-primary);">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1 align-text-bottom" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M7.707 3.293a1 1 0 010 1.414L5.414 7H11a7 7 0 017 7v2a1 1 0 11-2 0v-2a5 5 0 00-5-5H5.414l2.293 2.293a1 1 0 11-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" />
                        </svg>
                        おすすめの理由
                    </h4>
                    <p id="recommendationReason" class="text-base leading-relaxed"></p>
                </div>
            </div>

            <!-- アクションボタン群 -->
            <div class="flex flex-col md:flex-row justify-center space-y-3 md:space-y-0 md:space-x-6 mt-8">
                <a id="detailButton" href="#" target="_blank" class="action-button action-button-detail text-center py-3 px-8 rounded-full font-bold shadow-md hover:shadow-lg transition duration-200">
                    メニュー詳細を見る
                </a>
                <a id="bookingButton" href="#" target="_blank" class="action-button action-button-booking text-center py-3 px-8 rounded-full font-bold shadow-md hover:shadow-lg transition duration-200">
                    予約する
                </a>
            </div>

            <!-- 再診断ボタン -->
            <div class="text-center mt-8">
                <button id="reDiagnoseButton" class="clear-button py-3 px-10 rounded-full font-bold text-base shadow-md hover:shadow-lg transition duration-200">
                    再診断する
                </button>
            </div>
        </div>
    </main>

    <!-- フッター -->
    <footer class="footer-bg text-white py-8 px-4 mt-12">
        <div class="max-w-4xl mx-auto">
            <!-- フッターリンク -->
            <div class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-7 gap-y-3 text-sm mb-6 text-center">
                <a href="https://spiritual-therapist-mii.studio.site/" class="hover:text-amber-200 transition duration-200 underline">HOME</a>
                <a href="https://spiritual-therapist-mii.studio.site/menu" class="hover:text-amber-200 transition duration-200 underline">メニュー一覧</a>
                <a href="https://spiritual-therapist-mii.studio.site/reading" class="hover:text-amber-200 transition duration-200 underline">リーディング</a>
                <a href="https://spiritual-therapist-mii.studio.site/mirai-navi" class="hover:text-amber-200 transition duration-200 underline">未来ナビ</a>
                <a href="https://spiritual-therapist-mii.studio.site/art-therapy" class="hover:text-amber-200 transition duration-200 underline">アートセラピー</a>
                <a href="https://spiritual-therapist-mii.studio.site/color-card" class="hover:text-amber-200 transition duration-200 underline">カラーカード</a>
                <a href="https://spiritual-therapist-mii.studio.site/healing" class="hover:text-amber-200 transition duration-200 underline">ヒーリング</a>
                <a href="https://spiritual-therapist-mii.studio.site/f2f_reading" class="hover:text-amber-200 transition duration-200 underline">対面リーディング</a>
            </div>
            
            <!-- コピーライト -->
            <div class="text-center text-xs opacity-70">
                © 2024 by Therapist Mii. All rights reserved.
            </div>
        </div>
    </footer>

    <!-- トーストメッセージ表示エリア -->
    <div id="toastMessage" class="toast fixed bottom-5 left-1/2 -translate-x-1/2 p-3 rounded-xl shadow-2xl text-sm font-bold text-white z-50" style="background-color: var(--color-primary);">
        <!-- メッセージがここに表示される -->
    </div>

    <script>
        // --- データ定義 ---

        /**
         * サービスメニューと予約URLのマップ
         */
        const serviceMap = {
            'リーディング': {
                detail: 'https://spiritual-therapist-mii.studio.site/reading',
                booking: 'https://spiritual-therapist-mii.studio.site/reading-r'
            },
            '未来ナビ': {
                detail: 'https://spiritual-therapist-mii.studio.site/mirai-navi',
                booking: 'https://spiritual-therapist-mii.studio.site/mirai-navi-r'
            },
            'アートセラピー': {
                detail: 'https://spiritual-therapist-mii.studio.site/art-therapy',
                booking: 'https://spiritual-therapist-mii.studio.site/art-therapy-r'
            },
            'カラーカード': { // カラーカードはメニュー名として直接使われていないが、リンクとして定義
                detail: 'https://spiritual-therapist-mii.studio.site/color-card',
                booking: 'https://spiritual-therapist-mii.studio.site/color-card-r'
            },
            'カラーリーディング': { // カラーリーディングはカラーカードのリンクを使用
                detail: 'https://spiritual-therapist-mii.studio.site/color-card',
                booking: 'https://spiritual-therapist-mii.studio.site/color-card-r'
            },
            'ヒーリング': {
                detail: 'https://spiritual-therapist-mii.studio.site/healing',
                booking: 'https://spiritual-therapist-mii.studio.site/healing#h-yoyaku'
            },
            '対面リーディング': {
                detail: 'https://spiritual-therapist-mii.studio.site/f2f_reading',
                booking: 'https://spiritual-therapist-mii.studio.site/f2f-reading-r'
            }
        };

        /**
         * 色コードと診断結果データのリスト
         */
        const colorData = [
            { color: '#FF0000', message: 'あなたの情熱は周囲を明るく照らす力を持っています。そのエネルギーを、周りの人を鼓舞するためにぜひ使ってみましょう。', menu: '未来ナビ', reason: '今、目標達成への強い意欲があるあなたへ。「いつ、何をすべきか」という未来の地図の準備として、エネルギーを最高の成果へ導くための指針を立てるきっかけになりますよ。' },
            { color: '#FFE4E1', message: 'あなたは愛と優しさで満たされています。まずは自分自身に、たっぷりその優しさを注いであげることをおすすめします。', menu: 'ヒーリング', reason: '心の奥底で安心感と自己受容を求めているサインです。言葉にしづらい心の重さや疲れをそっと手放し、ご自身の全体バランスを整えるための最初の一歩を踏み出す準備ができますよ。' },
            { color: '#FFB6C1', message: '自分の持つ愛らしさや無邪気さを恥ずかしがらずに受け入れて表現してみましょう。それが、今のあなたの大きな魅力になります。', menu: 'アートセラピー', reason: '人生をもっと心のままに楽しみたいという願いがあります。言語化できない「モヤモヤ」を絵で表現し、心が解放に向かうためのヒントを見つけるきっかけになるでしょう。' },
            { color: '#FF8A80', message: '親しい人との温かい交流を大切にする時期です。不安や悲しみを感じたら、信頼できる人に気持ちを素直に伝えてみましょう。', menu: 'ヒーリング', reason: '温かい心の繋がりと安らぎを求めていますね。守護のサポートを受けながら、心身の滞りを優しく整え、疲れた心を深い安心感で満たすための土台づくりをしましょう。' },
            { color: '#6B4226', message: '焦らず、長期的な視点を持って計画を立てましょう。「地に足をつける」感覚を取り戻すために、体を動かしてみるのもおすすめです。', menu: '未来ナビ', reason: '人生の土台を固めたいという堅実な願いが込められています。「いつ、何をすべきか」という未来予報を活用し、具体的な行動計画を立てるためのきっかけを手に入れましょう。' },
            { color: '#C49E7D', message: 'これまでの経験や知識を活かし、周りの人に優しく伝えてみましょう。芸術鑑賞や読書など、心を豊かにする時間を持つことが大切です。', menu: 'リーディング', reason: '内面的な豊かさや深い知恵に光が当たっています。守護霊様からの高次なメッセージは、ご自身の持つ魂の本質的な方向性を深く知るための準備段階として、大切な気づきを与えてくれます。' },
            { color: '#D35400', message: 'あなたには、変化を起こすための集中力とエネルギーがあります。情熱を一点に集中させ、目標を突破する力を信じてください。', menu: '未来ナビ', reason: '停滞している状況を打破し、エネルギーを爆発させたいという強い意志があります。短期的な見通しと対策（未来予報）を活用し、目標突破のための戦略を練る準備を整えましょう。' },
            { color: '#FF9800', message: '人生は心から楽しむためにあります。あなたの持つ明るさで、周りの人にも喜びを分けてあげてください。', menu: 'アートセラピー', reason: 'もっと自由に、喜びを表現したいという心のサインです。言葉にならない感情を、絵を通じて解放し、深層心理に隠された「魂の本音」を発見するきっかけを見つけてみましょう。' },
            { color: '#FFCC80', message: 'あなたの親しみやすさは、大きな魅力です。心を開いて、周りの人との会話や交流を楽しんでみてください。', menu: 'カラーリーディング', reason: '軽やかさや交流を楽しみたいという今の気分にぴったりです。色からの「メッセージのエッセンス」を手軽に知り、内省を深めるための最初のヒントを受け取れますよ。' },
            { color: '#F4A261', message: 'あなたは、自信を持って輝くことができます。あなたの個性を隠さず、積極的に表現することに意識を向けてください。', menu: 'アートセラピー', reason: '「自分の個性を発揮したい」「自信を高めたい」という願いがあります。視覚的な表現を通じて、「誰も知らない自分」や埋もれていた本音を深く掘り起こすきっかけを見つけてみましょう。' },
            { color: '#F9A825', message: 'あなたは、物事の本質を見抜く力を持っています。深く考え、あなたの明晰な洞察力を信じて行動することをおすすめします。', menu: 'リーディング', reason: '物事の本質や知的な探求心がテーマです。「思考カラーマップ」で心の状態を客観的に分析し、人生の確かな方向性を定める最初の一歩となるヒントを得られます。深い洞察は、有料セッションでさらに掘り下げていきます。' },
            { color: '#FDD835', message: 'あなたの内側には、無限の可能性を秘めた閃きがあります。その大切なアイデアを、ぜひ行動に移してみましょう。', menu: '未来ナビ', reason: '現状を打破する斬新なアイデアを求めているサインです。未来予報を通じて「チャンスの最大化」を図り、ひらめきを現実の成果に結びつけるための道筋を立てる準備をしましょう。' },
            { color: '#ffffe6', message: 'あなたの前には、無限の可能性が広がっています。固定観念を捨て、自由に理想の未来を描いてみましょう。', menu: 'ヒーリング', reason: '「全てをリセットし、まっさらになりたい」という心の叫びです。セルフケアでは抜けきらない心の重さや詰まりを整え、新しい始まりのための土台づくりをサポートします。' },
            { color: '#DCE775', message: '急いで結果を出そうとせず、今の努力が未来の大きな実りにつながると信じて、日々の小さな変化を楽しんでください。', menu: 'ヒーリング', reason: '穏やかなペースでの成長を望み、心身のリフレッシュが必要です。守護のサポートを受けながら、全体的なバランスを整えることで、着実なステップアップを応援する準備ができます。' },
            { color: '#EC407A', message: 'あなたは、深い愛と喜びに満たされた存在です。その愛のエネルギーを解放し、人生を情熱的に楽しむことを自分に許可してあげてください。', menu: 'アートセラピー', reason: '「生きる喜びを深く感じたい」「自己肯定感を高めたい」という情熱的なテーマです。視覚的な表現を通して、心のブロックを外し、愛のエネルギーを解放するきっかけを掴めますよ。' },
            { color: '#F48FB1', message: 'あなたは、優雅で洗練された美しさを持っています。自分自身を最高に美しく、丁寧に扱ってあげてください。', menu: 'アートセラピー', reason: '内面と外面、両方の美しさを求める美意識の現れです。深層心理を掘り下げ、真の魅力を妨げる潜在的なブロックを解消するきっかけを見つけてみましょう。より深いトラウマケアは有料セッションでご提供します。' },
            { color: '#F8BBD0', message: 'あなたは、優しさと癒やしの力に満ちています。疲れた自分を許し、温かい思いやりを注いでみましょう。', menu: 'ヒーリング', reason: '心身の疲れを癒やし、リラックスしたいという強い願いがあります。言葉にしづらい心身の「だるさ・重さ」を整え、自己受容を深めるための優しい準備ができますよ。' },
            { color: '#FFF0F5', message: 'あなたの夢と、そこにある純粋な愛を信じてください。その気持ちが、あなたの未来を美しく彩るでしょう。', menu: 'アートセラピー', reason: '純粋な愛の感情や、理想的な未来を描きたいという願いが込められています。深層心理分析で「魂の本音」を知り、人生で大切にすべきことを明確にするヒントを得られます。' },
            { color: '#FFFAFA', message: 'あなたは、縛られることなく自由になることができます。自分の心の声に従って、軽やかに行動してみましょう。', menu: 'ヒーリング', reason: '過去の感情的な重荷から解放され、軽やかになりたいという強いサインです。心身の「詰まり」を整え、エネルギーを浄化することで、より自由に羽ばたく準備が整います。' },
            { color: '#E6E6FA', message: 'あなたの内側には、深い静けさと高貴な精神性があります。静かな時間を作り、内面からのメッセージを受け取ってみてください。', menu: 'リーディング', reason: '日々の喧騒から離れ、精神的な平和とインスピレーションを求めています。「魂が本当に望むこと」など、人生の本質的な方向性を知る高次なメッセージに触れるきっかけになります。' },
            { color: '#CE93D8', message: 'あなたは、そのままで十分完璧な存在です。欠点も含めて自分自身を深く受け入れ、優しさを周りの人にも分けてあげてください。', menu: 'ヒーリング', reason: '自分自身の全てを受け入れたいという癒やしのテーマです。自己治癒力が働く土台づくりをすることで、内なる癒やしが深まり、自己受容のプロセスが穏やかに進む準備ができます。' },
            { color: '#8E24AA', message: 'あなたには、自分を変えるための、計り知れない精神的な力が備わっています。その力を信じ、内なる変革を始めてみませんか。', menu: 'リーディング', reason: '現状から脱却し、「本当の自分」に生まれ変わりたいという根源的な願いがあります。スピリチュアルな視点から、あなたの人生の深い意味と方向性を知る最初の一歩となるでしょう。' },
            { color: '#6A1B9A', message: 'あなたの高い理想は、実現可能です。直感を信じ、その知恵を活かして、一歩ずつ現実のものにしていきましょう。', menu: '未来ナビ', reason: '高い理想やビジョンの実現が目前です。具体的な未来予報を通じて「チャンスの最大化」を図り、理想を実現するための行動を後押しする指針を立てることができます。' },
            { color: '#3F3F74', message: 'あなたの知性と規律は、あなた自身を守る盾となります。感情に流されず、冷静に計画を実行することをおすすめします。', menu: 'リーディング', reason: '感情の波に左右されない強い自分になりたいという願いがあります。「思考カラーマップ」で心の状態を客観的に分析し、冷静で理性的な「自分軸」を確立する準備をお手伝いします。' },
            { color: '#2196F3', message: 'あなたの創造性は無限大です。心を解き放ち、感じたこと、考えたことを自由に表現してみましょう。', menu: 'アートセラピー', reason: '自由な発想と、オープンな自己表現がテーマです。言葉にできない創造的なエネルギーを「絵や筆跡」で表すことで、あなたの心を深く解放し、スッキリ感を味わうきっかけを掴めます。' },
            { color: '#1976D2', message: 'あなたの信念と誠実さは、本物です。その信念を貫き、周りの人からの信頼の証として行動で示しましょう。', menu: '未来ナビ', reason: '自分の信念に基づいて行動し、責任を果たしたいという強い思いがあります。「リスクマネジメント」や「具体的な対策」など、堅実な行動を支える指針を立てるきっかけを掴みましょう。' },
            { color: '#BBDEFB', message: 'あなたの心は、穏やかで平和な状態に戻ろうとしています。焦らず、その自然な流れに身を任せてあげてください。', menu: 'ヒーリング', reason: '心に平和と静けさを求め、リラックスしたいというサインです。心のざわつきや、セルフケアでは抜けない心の詰まりを整え、穏やかで安心できる状態へ戻る土台づくりをサポートします。' },
            { color: '#000080', message: 'あなたの内側には、全てを知る深い知恵があります。静かな時間を作り、瞑想を通じてその声に耳を傾けてみましょう。', menu: 'リーディング', reason: '人生の深い意味や、内なる真実を知りたいという探求心があります。「魂が本当に望むこと」を知り、自分の内面にある真の力を引き出すメッセージのヒントを受け取ってみませんか。' },
            { color: '#B2EBF2', message: 'あなたの心は、風のように自由で清らかです。肩の力を抜き、軽やかに、思うままに羽ばたいてみましょう。', menu: 'カラーリーディング', reason: '束縛から解放され、軽やかになりたいという願いがあります。日常の中で「ちょっとした指針」となるメッセージを手軽に受け取り、内省を始めるきっかけにするのに最適です。' },
            { color: '#1ABC9C', message: 'あなたの心は、今、調和を取り戻そうとしています。無理せず、心と体の声に耳を傾け、バランスの取れた生活を心がけてください。', menu: 'ヒーリング', reason: '心と体のバランス、穏やかな調和がテーマです。心身の滞りやモヤを整え、守護のサポートを受けながら、全体的なバランスを回復させるための準備をします。' },
            { color: '#43A047', message: 'あなたの努力は、必ず実を結びます。急いで結果を求めず、日々の成長と小さな達成を楽しむことに意識を向けてください。', menu: '未来ナビ', reason: '焦らず着実に進みたいという願いがあります。未来予報で「リスクマネジメント」や「チャンスの最大化」を計画し、努力を確実な実りへと導く指針を立てる準備をしていきましょう。' },
            { color: '#AEEA00', message: 'あなたの人生は、今、新しい成長期に入っています。好奇心とユーモアを持って、目の前の課題に飛び込んでみましょう。', menu: 'カラーリーディング', reason: '活発な成長と、新しいアイデアを求めているサインです。「メッセージのエッセンス」を受け取り、その「余白」をご自身で読み解くことで、内省と成長を楽しむきっかけが得られますよ。' },
            { color: '#f3ffd1', message: 'あなたは、そのままで十分魅力的です。肩の力を抜き、ありのままの自分でいることを自分に許可してあげてください。', menu: 'カラーリーディング', reason: '義務やプレッシャーから解放され、自然体で過ごしたいという願いがあります。安価に、日常の中で「ちょっとした指針」を受け取り、軽やかに心身を整えるためのヒントにするのに最適です。' },
            { color: '#E0E1DD', message: 'あなたは、感情から一歩引いて物事を眺めることができる、賢明な人です。あなたの客観的な視点を信じて行動してください。', menu: 'リーディング', reason: '感情に流されず、冷静な知性を求めています。「思考カラーマップ」で心の状態を客観的に分析し、理性と知恵を持って人生の方向性を定めるための最初のヒントが得られます。' },
            { color: '#6D6D6D', message: 'あなたの内側には、しっかりと確立された「自分軸」があります。周りの意見に惑わされず、自分の価値観を信じてください。', menu: 'リーディング', reason: '他者に依存せず、自分の軸を確立したいという強い願いがあります。魂が本当に望むことなど、本質的な人生の方向性を知り、揺るぎない「自分軸」を強化する準備ができます。' },
            { color: '#3A3A3A', message: 'あなたの中には、物事の全てを受け止め、支える基盤となる力強さがあります。恐れず、自分の深い部分と向き合ってみましょう。', menu: 'リーディング', reason: '揺るぎない基盤を築きたいという強い思いがあります。漠然とした「悩み事」や「人生の迷い」があるなら、スピリチュアルな視点から本質的な人生の方向性を見つけるための最初のヒントを受け取れます。' },
            { color: '#FFFFFF', message: 'あなたは、無限の可能性と、純粋な光に満ちた存在です。過去の全てを許し、理想の未来を自由に描いていきましょう。', menu: '未来ナビ', reason: '最高の理想と新しい人生の始まりという未来志向のテーマです。未来予報を活用して「チャンスの最大化」を図り、理想の未来を現実のものにするための具体的な行動計画を立てる準備をしましょう。' }
        ];

        // --- DOM要素の取得 ---
        const colorPalette = document.getElementById('colorPalette');
        const selectedPalette = document.getElementById('selectedPalette');
        const diagnoseButton = document.getElementById('diagnoseButton');
        const clearSelectionButton = document.getElementById('clearSelection');
        const selectionHint = document.getElementById('selectionHint');
        const resultArea = document.getElementById('resultArea');
        const combinedMessageEl = document.getElementById('combinedMessage');
        const recommendedMenuEl = document.getElementById('recommendedMenu');
        const recommendationReasonEl = document.getElementById('recommendationReason');
        const detailButton = document.getElementById('detailButton');
        const bookingButton = document.getElementById('bookingButton');
        const reDiagnoseButton = document.getElementById('reDiagnoseButton');
        const toastMessageEl = document.getElementById('toastMessage');

        // 選択された色のデータオブジェクトを格納する配列（気になる順、最大3つ）
        let selectedColors = [];

        // --- ユーティリティ関数 ---

        /**
         * トーストメッセージを表示する
         * @param {string} message - 表示するメッセージ
         */
        function showToast(message) {
            toastMessageEl.textContent = message;
            toastMessageEl.classList.add('show');
            setTimeout(() => {
                toastMessageEl.classList.remove('show');
            }, 2000);
        }

        /**
         * テキストの色に応じて、そのテキストを見やすくするための色（白または黒）を決定する
         * @param {string} hexcolor - HEXカラーコード
         * @returns {string} 'white' または 'black'
         */
        function getTextColor(hexcolor) {
            // HEXをRGBに変換
            const r = parseInt(hexcolor.substring(1, 3), 16);
            const g = parseInt(hexcolor.substring(3, 5), 16);
            const b = parseInt(hexcolor.substring(5, 7), 16);

            // 輝度を計算 (Luminance)
            const brightness = (r * 299 + g * 587 + b * 114) / 1000;
            return (brightness > 180) ? 'black' : 'white'; // 180を閾値として、明るい色は黒文字、暗い色は白文字
        }

        /**
         * 選択パレットのUIを更新する
         */
        function updateSelectedColorsUI() {
            selectedPalette.innerHTML = '';
            
            if (selectedColors.length === 0) {
                selectionHint.textContent = `現在 ${selectedColors.length}/3 色選択中`;
                selectedPalette.appendChild(selectionHint);
            } else {
                selectionHint.textContent = `現在 ${selectedColors.length}/3 色選択中`;
                selectedPalette.appendChild(selectionHint);
                
                selectedColors.forEach((colorObj, index) => {
                    const card = document.createElement('div');
                    const textColor = getTextColor(colorObj.color);

                    card.className = `w-12 h-12 md:w-16 md:h-16 rounded-full flex items-center justify-center cursor-pointer shadow-md selected-color-card border-4 border-white transition duration-200 ease-in-out`;
                    card.style.backgroundColor = colorObj.color;
                    
                    // 選択順序を表示 (スマホでも見やすいよう大きめのフォント)
                    card.innerHTML = `<span class="text-lg font-bold" style="color: ${textColor};">${index + 1}</span>`;
                    
                    // データ属性に色コードを保持（選択解除時に本体パレットのカードを探すため）
                    card.setAttribute('data-color', colorObj.color);

                    card.addEventListener('click', () => handleColorClick(colorObj.color, card));
                    selectedPalette.appendChild(card);
                });
            }
            
            // ボタンの状態を更新
            const isThreeSelected = selectedColors.length === 3;
            diagnoseButton.disabled = !isThreeSelected;
            clearSelectionButton.disabled = selectedColors.length === 0;

            if (isThreeSelected) {
                diagnoseButton.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                diagnoseButton.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }

        /**
         * メインパレットに色カードを生成する
         */
        function initializeColorPalette() {
            colorPalette.innerHTML = '';
            colorData.forEach(item => {
                const card = document.createElement('div');
                card.className = 'w-full aspect-square rounded-xl shadow-md cursor-pointer transition duration-200 hover:scale-[1.03] active:scale-100';
                card.style.backgroundColor = item.color;
                card.setAttribute('data-color', item.color);

                // 白色背景に白のカードが見えるように、白色には薄いグレーの枠を付ける
                if (item.color.toUpperCase() === '#FFFFFF') {
                    card.style.border = '1px solid #ccc';
                }

                card.addEventListener('click', () => handleColorClick(item.color, card));
                colorPalette.appendChild(card);
            });
        }

        /**
         * 色カードクリック時のハンドラー
         * @param {string} colorCode - クリックされた色コード
         * @param {HTMLElement} card - クリックされた色カード要素（メインパレットまたは選択パレットのもの）
         */
        function handleColorClick(colorCode, card) {
            const index = selectedColors.findIndex(item => item.color === colorCode);
            
            if (index > -1) {
                // 既に選択されている場合（解除）
                selectedColors.splice(index, 1);
                
                // メインパレットのカードから選択状態のスタイルを削除
                const mainCard = colorPalette.querySelector(`[data-color="${colorCode}"]`);
                if (mainCard) {
                    mainCard.classList.remove('selected-color-card');
                }
                
                showToast('色を解除しました。');
            } else {
                // 未選択の場合（選択）
                if (selectedColors.length < 3) {
                    const colorObj = colorData.find(item => item.color === colorCode);
                    if (colorObj) {
                        selectedColors.push(colorObj);
                        
                        // メインパレットのカードに選択状態のスタイルを追加
                        card.classList.add('selected-color-card');
                        
                        showToast('色を選択しました。');
                    }
                } else {
                    showToast('選択できるのは3色までです。');
                }
            }
            
            updateSelectedColorsUI();
            
            // 診断結果エリアを隠す
            resultArea.classList.add('hidden');
        }

        /**
         * メニュー診断を実行する
         */
        function runDiagnosis() {
            if (selectedColors.length !== 3) {
                showToast('3色選択してください。');
                return;
            }

            // 1. 総合メッセージを生成 (3つのメッセージを連結)
            const combinedMessage = selectedColors.map(item => item.message).join('\n\n');

            // 2. おすすめメニューを決定 (最も出現頻度の高いメニュー)
            const menuCounts = {};
            selectedColors.forEach(item => {
                menuCounts[item.menu] = (menuCounts[item.menu] || 0) + 1;
            });

            let recommendedMenuName = selectedColors[0].menu; // デフォルトは最初に選んだ色
            let maxCount = 1;
            let finalRecommendation = selectedColors[0]; // 理由取得のために使用

            // 出現頻度をチェック
            for (const menu in menuCounts) {
                if (menuCounts[menu] > maxCount) {
                    maxCount = menuCounts[menu];
                    recommendedMenuName = menu;
                }
            }

            // 最多出現メニューに関連する色を検索し、その理由とリンクを使用
            // (最初の色を優先し、それが最多メニューでない場合は最多メニューの色を使う)
            if (maxCount === 1) { // 1-1-1の場合、最初の色をそのまま採用
                finalRecommendation = selectedColors[0];
                recommendedMenuName = selectedColors[0].menu;
            } else {
                // 2-1-0または3-0-0の場合、最多メニューに該当する最初の色を採用
                finalRecommendation = selectedColors.find(item => item.menu === recommendedMenuName);
            }

            const recommendedReason = finalRecommendation.reason;
            const menuLinks = serviceMap[recommendedMenuName];
            
            if (!menuLinks) {
                showToast(`エラー: ${recommendedMenuName} のリンク情報が見つかりません。`);
                return;
            }

            // 3. 診断結果をUIに反映
            combinedMessageEl.textContent = combinedMessage;
            recommendedMenuEl.textContent = recommendedMenuName;
            recommendationReasonEl.textContent = recommendedReason;
            
            // 4. アクションボタンのリンクを更新
            detailButton.href = menuLinks.detail;
            bookingButton.href = menuLinks.booking;

            // 5. 結果エリアを表示し、スクロール
            resultArea.classList.remove('hidden');
            resultArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // 診断実行後はボタンを無効化（再診断を促すため）
            diagnoseButton.disabled = true;
            diagnoseButton.classList.add('opacity-50', 'cursor-not-allowed');
        }

        /**
         * 再診断を実行する（全てをリセット）
         */
        function reDiagnose() {
            selectedColors = [];
            
            // メインパレットの選択状態を全て解除
            const mainCards = colorPalette.querySelectorAll('.selected-color-card');
            mainCards.forEach(card => card.classList.remove('selected-color-card'));
            
            // 選択パレットとボタンの状態を更新
            updateSelectedColorsUI();
            
            // 結果エリアを隠す
            resultArea.classList.add('hidden');

            showToast('診断をリセットしました。');
        }


        // --- イベントリスナー設定 ---

        // メニュー診断ボタン
        diagnoseButton.addEventListener('click', runDiagnosis);

        // 選んだ色を消す (リセット) ボタン
        clearSelectionButton.addEventListener('click', reDiagnose);
        
        // 再診断するボタン
        reDiagnoseButton.addEventListener('click', reDiagnose);


        // --- 初期化 ---

        // ページ読み込み時にパレットを初期化
        window.onload = () => {
            initializeColorPalette();
            updateSelectedColorsUI(); // 初期状態のUIをレンダリング
        };

    </script>
</body>
</html>
