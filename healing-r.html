<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ヒーリングお見積り＆ご予約フォーム</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="https://github.com/therapist-mii/spiritual/raw/main/images/favicon.png">
    <style>
        body {
            font-family: 'Noto Serif JP', serif;
            color: #776163;
            background-color: #F8F6F4;
        }

        /* カスタムカラー */
        .text-custom { color: #776163; }
        .bg-button { background-color: #E4C1B5; }
        .hover\:bg-button-hover:hover { background-color: #ad9196; }
        .bg-special-button { background-color: #e4b5b9; }
        .hover\:bg-special-button-hover:hover { background-color: #ad9196; }
        .bg-clear-button { background-color: #7a736a; }
        .hover\:bg-clear-button-hover:hover { background-color: #E4C1B5; }
        .text-clear-button-x { color: #EAE6E1; }
        .hover\:text-clear-button-x-hover:hover { color: #cbb6b6; }
        .border-error { border-color: #ff0000; }
        .text-error { color: #ff0000; }
        
        /* フォーム入力の共通スタイル */
        .form-input {
            width: 100%;
            border: 1px solid #E4C1B5;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            background-color: #fff;
            transition: all 0.3s ease;
        }
        .form-input:focus {
            outline: none;
            border-color: #ad9196;
            box-shadow: 0 0 0 3px rgba(173, 145, 150, 0.2);
        }

        /* アニメーション */
        .fade-in {
            animation: fadeIn 1s ease-in-out;
        }
        .slide-up {
            animation: slideUp 0.8s ease-out forwards;
            opacity: 0;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* アニメーション遅延 */
        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
        .delay-4 { animation-delay: 0.4s; }
        .delay-5 { animation-delay: 0.5s; }
        .delay-6 { animation-delay: 0.6s; }
        
        /* カスタムモーダル */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 90%;
            width: 500px;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s;
        }
        .modal-overlay.visible .modal-content {
            transform: scale(1);
        }
    </style>
</head>
<body class="bg-[#F8F6F4]">

    <!-- ヘッダー -->
    <header class="py-4 px-6 fade-in">
        <div class="container mx-auto flex justify-center">
            <a href="https://spiritual-therapist-mii.studio.site/" target="_blank">
                <img src="https://github.com/therapist-mii/spiritual/raw/main/images/rogo-250.png" alt="ロゴ" class="h-16 md:h-20">
            </a>
        </div>
    </header>

    <!-- メインコンテンツ -->
    <main class="container mx-auto p-4 md:p-8">
        <div class="bg-white/50 shadow-lg rounded-2xl p-6 md:p-10 max-w-3xl mx-auto">
            
            <h1 class="text-2xl md:text-3xl font-bold text-center text-custom mb-8 slide-up">ヒーリングお見積り＆ご予約</h1>
            
            <form id="healing-form" class="space-y-10">
                
                <!-- メニュー選択 -->
                <section class="slide-up delay-1">
                    <h2 class="text-xl font-semibold mb-4 text-custom">メニュー選択</h2>
                    <div class="space-y-3">
                        <label class="flex items-center p-3 rounded-lg hover:bg-[#E4C1B5]/20 transition-colors duration-300">
                            <input type="checkbox" name="menu" value="5000" data-name="おまかせヒーリング" class="h-5 w-5 rounded border-gray-300 text-[#ad9196] focus:ring-[#ad9196]">
                            <span class="ml-3">おまかせヒーリング 30分 <span class="font-semibold ml-2">5,000円</span></span>
                        </label>
                        <label class="flex items-center p-3 rounded-lg hover:bg-[#E4C1B5]/20 transition-colors duration-300">
                            <input type="checkbox" name="menu" value="5000" data-name="メンタルヒーリング" class="h-5 w-5 rounded border-gray-300 text-[#ad9196] focus:ring-[#ad9196]">
                            <span class="ml-3">メンタルヒーリング 30分 <span class="font-semibold ml-2">5,000円</span></span>
                        </label>
                        <label class="flex items-center p-3 rounded-lg hover:bg-[#E4C1B5]/20 transition-colors duration-300">
                            <input type="checkbox" name="menu" value="5000" data-name="エネルギートリートメント" class="h-5 w-5 rounded border-gray-300 text-[#ad9196] focus:ring-[#ad9196]">
                            <span class="ml-3">エネルギートリートメント 30分 <span class="font-semibold ml-2">5,000円</span></span>
                        </label>
                        <label class="flex items-center p-3 rounded-lg hover:bg-[#E4C1B5]/20 transition-colors duration-300">
                            <input type="checkbox" name="menu" value="5000" data-name="ヘッドヒーリング" class="h-5 w-5 rounded border-gray-300 text-[#ad9196] focus:ring-[#ad9196]">
                            <span class="ml-3">ヘッドヒーリング 30分 <span class="font-semibold ml-2">5,000円</span></span>
                        </label>
                    </div>
                     <p class="mt-4 text-center text-sm">
                        1分ヒーリングをご希望の方は<a href="https://therapist-mii.github.io/spiritual/1healing-r.html" target="_blank" class="text-[#ad9196] hover:underline">こちらから</a>
                    </p>
                </section>

                <!-- ご利用回数 -->
                <section class="slide-up delay-2">
                    <label for="visit-count" class="text-xl font-semibold mb-4 text-custom block">当サロンご利用回数</label>
                    <select id="visit-count" name="visit-count" class="form-input">
                        <option value="first">はじめて</option>
                        <option value="repeat">２回以上</option>
                    </select>
                </section>
                
                <!-- 報告書選択 -->
                <section class="slide-up delay-3">
                    <h2 class="text-xl font-semibold mb-4 text-custom">報告タイプを選択してください<span class="text-error">*</span></h2>
                    <div id="report-options" class="space-y-3">
                        <!-- ラジオボタンはJSで生成 -->
                    </div>
                    <div id="body-consult-extra" class="mt-4 hidden">
                         <label for="body-consult-count" class="block mb-2 text-sm font-medium text-custom">追加のご相談件数（1件ごとに3,000円）</label>
                         <input type="number" id="body-consult-count" name="body-consult-count" min="0" value="0" class="form-input w-full md:w-1/2">
                    </div>
                </section>
                
                <!-- お支払いについて -->
                <section class="slide-up delay-4">
                    <h2 class="text-xl font-semibold mb-4 text-custom">お支払いについて</h2>
                    <div class="space-y-6">
                        <!-- クーポン -->
                        <div>
                            <label for="coupon" class="block mb-2 font-medium">クーポン</label>
                            <p class="text-sm mb-2">クーポンをお持ちの方は選択してください。</p>
                            <select id="coupon" name="coupon" class="form-input">
                                <option value="0">選択してください</option>
                                <option value="0">クーポン無し</option>
                                <option value="0.05">5％OFFクーポン</option>
                                <option value="0.10">10％OFFクーポン</option>
                                <option value="0.15">15％OFFクーポン</option>
                                <option value="0.20">20％OFFクーポン</option>
                                <option value="0.25">25％OFFクーポン</option>
                                <option value="0.30">30％OFFクーポン</option>
                            </select>
                        </div>
                        <!-- 紹介割引 -->
                        <div>
                            <p class="font-medium mb-2">紹介割引</p>
                            <p class="text-sm mb-3">ご紹介くださった方と紹介された方を対象に割引できます。他クーポン併用可 紹介割引：−500円</p>
                            <button type="button" id="referral-button" class="px-6 py-2 rounded-lg bg-button text-white transition-all duration-300 hover:bg-button-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#ad9196]">追加する</button>
                        </div>
                        <!-- お支払い方法 -->
                        <div>
                            <label for="payment-method" class="block mb-2 font-medium">お支払い方法<span class="text-error">*</span></label>
                            <select id="payment-method" name="payment-method" class="form-input">
                                <option value="">選択してください</option>
                                <option value="銀行振込">銀行振込</option>
                                <option value="Paypay">Paypay</option>
                                <option value="Paypal">Paypal</option>
                                <option value="クレジットカード">クレジットカード</option>
                                <option value="コンビニ払い">コンビニ払い（手数料220円）</option>
                            </select>
                        </div>
                    </div>
                </section>

                <!-- 備考 -->
                <section class="slide-up delay-5">
                    <label for="remarks" class="text-xl font-semibold mb-4 text-custom block">備考（任意）</label>
                    <textarea id="remarks" name="remarks" rows="4" class="form-input" placeholder="ご希望やご質問があればご記入ください。"></textarea>
                </section>

                <!-- ご確認事項 -->
                <section class="space-y-6 bg-[#E4C1B5]/10 p-5 rounded-lg border border-[#E4C1B5]/50 slide-up delay-6">
                    <h2 class="text-xl font-semibold text-center text-custom">ご確認事項</h2>
                    <div class="text-sm space-y-4">
                        <div>
                            <h3 class="font-bold mb-1">■ セッションについて</h3>
                            <p>セッション形式： 遠隔</p>
                            <p>ご予約： 日にち指定のみ（時間指定不可）</p>
                        </div>
                        <div>
                            <h3 class="font-bold mb-1">■ 納品日・営業時間</h3>
                            <p>納品日：セッション日より5営業日</p>
                            <p>営業時間： 9：00～17：00</p>
                            <p>休日：土日祝日、他指定日</p>
                        </div>
                        <div>
                            <h3 class="font-bold mb-1">■ セッション後の追加料金について</h3>
                            <p>納品後に、追加の相談がある場合、追加料金が発生いたします。<br>ご相談１件：3,000円～</p>
                        </div>
                         <div id="submission-info" class="hidden">
                            <h3 class="font-bold mb-2">■ ご提出いただくもの（はじめての方のみ）</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-center">
                                <div class="p-2 border rounded-md">
                                    <p>目元の写真</p>
                                    <img src="https://github.com/therapist-mii/spiritual/raw/main/images/memoto.jpg" alt="目元の写真の例" class="mt-2 mx-auto rounded-md w-48">
                                </div>
                                <div class="p-2 border rounded-md">
                                    <p>手書きのお名前</p>
                                    <img src="https://github.com/therapist-mii/spiritual/raw/main/images/name.jpg" alt="手書きのお名前の例" class="mt-2 mx-auto rounded-md w-48">
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

            </form>
            
            <!-- お見積もり結果 -->
            <section class="mt-12">
                <h2 class="text-2xl font-bold text-center text-custom mb-6">お見積もり内容</h2>
                <div class="bg-[#E4C1B5]/10 p-6 rounded-lg border border-[#E4C1B5]/50">
                    <pre id="quote-output" class="whitespace-pre-wrap text-custom text-base leading-relaxed"></pre>
                </div>
            </section>
            
            <!-- ボタン -->
            <section class="mt-10">
                <div class="relative flex items-center justify-center my-6">
                    <button id="clear-form" class="absolute left-0 top-1/2 -translate-y-1/2 p-3 rounded-full hover:bg-gray-200 transition-colors duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-[#cbb6b6] hover:text-[#ad9196] transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                    <span class="text-xs text-gray-500">クリア</span>
                </div>

                <div class="flex flex-col md:flex-row gap-4">
                    <button id="copy-quote" class="w-full py-3 px-6 bg-button text-white font-semibold rounded-lg shadow-md hover:bg-button-hover transition-all duration-300 transform hover:-translate-y-0.5">お見積り内容をコピー</button>
                </div>

                <div class="mt-8 text-center">
                    <h3 class="font-semibold mb-2">【LINEで予約する際の手順】</h3>
                    <p class="text-sm text-left bg-gray-100 p-4 rounded-lg">
                        ① お見積り内容にご了承いただけましたら、コピーボタンを押し、お見積り内容をコピーしてください。<br>
                        ② 下の「LINEに貼り付けて予約する」ボタンを押し、起動したLINEに貼り付けて送信ください。
                    </p>
                </div>
                <div class="mt-4">
                     <button id="line-redirect" class="w-full py-4 px-6 bg-green-500 text-white font-bold rounded-lg shadow-lg hover:bg-green-600 transition-all duration-300 flex items-center justify-center gap-2">
                        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M16.1,12.42a1,1,0,0,0-1.25.21,4.71,4.71,0,0,1-3.15,1.5,4.82,4.82,0,0,1-3.18-1.5,1,1,0,0,0-1.26-.21,1,1,0,0,0-.49,1.13,6.83,6.83,0,0,0,4.93,2.2,6.7,6.7,0,0,0,4.9-2.2A1,1,0,0,0,16.1,12.42ZM8.42,11.06a1.36,1.36,0,1,0-1.35-1.36A1.36,1.36,0,0,0,8.42,11.06Zm7.16,0a1.36,1.36,0,1,0-1.35-1.36A1.36,1.36,0,0,0,15.58,11.06Zm6.31-2.42a8.63,8.63,0,0,0-8.23-8.58H8.34a8.62,8.62,0,0,0-8.27,8.58,8.41,8.41,0,0,0,1.5,4.94L.06,17.7a1.14,1.14,0,0,0,.31,1.62,1.1,1.1,0,0,0,.47.11,1.15,1.15,0,0,0,.89-.41l3.52-4.1a8.55,8.55,0,0,0,13.25,0l3.52,4.1a1.13,1.13,0,0,0,1.36-.3,1.14,1.14,0,0,0,.31-1.62l-1.5-4.14A8.4,8.4,0,0,0,21.89,8.64Z"></path></svg>
                        LINEに貼り付けて予約する
                     </button>
                </div>
            </section>
        </div>
    </main>
    
    <!-- フッター -->
    <footer class="bg-white/50 mt-12 py-10 px-6">
        <div class="container mx-auto max-w-3xl text-center">
            <div class="mb-8 p-6 bg-special-button/20 rounded-lg">
                <h3 class="text-lg font-semibold mb-2 text-custom">はじめての方へ</h3>
                <p class="text-sm mb-4">はじめての方は、以下のフォームにご記入お願いいたします。<br>リピーター様も未入力の方はご記入お願いいたします。</p>
                <a href="https://spiritual-therapist-mii.studio.site/form" target="_blank" class="inline-block px-8 py-3 bg-special-button text-white font-semibold rounded-lg shadow-md hover:bg-special-button-hover transition-all duration-300">
                    はじめての方のフォーム
                </a>
            </div>

            <div class="my-8 flex justify-center gap-6 md:gap-10">
                <a href="https://spiritual-therapist-mii.studio.site/" target="_blank" class="hover:text-[#ad9196] transition-colors">Home</a>
                <a href="https://spiritual-therapist-mii.studio.site/menu" target="_blank" class="hover:text-[#ad9196] transition-colors">メニュー一覧</a>
            </div>

            <div class="flex justify-center mt-6">
                 <a href="https://spiritual-therapist-mii.studio.site/" target="_blank">
                     <img src="https://github.com/therapist-mii/spiritual/raw/main/images/rogo-250.png" alt="ロゴ" class="h-20 md:h-24">
                 </a>
            </div>
        </div>
    </footer>

    <!-- カスタムモーダル -->
    <div id="modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <h3 class="text-xl font-bold text-red-600 mb-4">コピー</h3>
            <p id="modal-message" class="text-gray-700 mb-6"></p>
            <button id="modal-close" class="px-6 py-2 bg-button text-white rounded-lg hover:bg-button-hover transition-colors">閉じる</button>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- 要素の取得 ---
            const form = document.getElementById('healing-form');
            const quoteOutput = document.getElementById('quote-output');
            const referralButton = document.getElementById('referral-button');
            const bodyConsultExtra = document.getElementById('body-consult-extra');
            const visitCountSelect = document.getElementById('visit-count');
            const submissionInfo = document.getElementById('submission-info');
            const clearButton = document.getElementById('clear-form');
            const copyButton = document.getElementById('copy-quote');
            const lineButton = document.getElementById('line-redirect');
            const modalOverlay = document.getElementById('modal-overlay');
            const modalMessage = document.getElementById('modal-message');
            const modalClose = document.getElementById('modal-close');

            let isReferralApplied = false;

            // --- 報告書データ ---
            const reportData = [
                { id: 'report-0', value: 0, name: '報告不要', description: '0円' },
                { id: 'report-1', value: 2000, name: 'ミニ報告', description: '2,000円' },
                { id: 'report-2', value: 5000, name: '1部位鑑定書', description: '5,000円' },
                { id: 'report-3', value: 15000, name: '鑑定書', description: '15,000円' },
                { id: 'report-4', value: 15000, name: 'オーラアート', description: '15,000円' },
                { id: 'report-5', value: 20000, name: '鑑定書＋オーラアート', description: '20,000円' },
                { id: 'report-6', value: 16000, name: 'お体のご相談', description: '16,000円' }
            ];

            // --- 報告書オプションの動的生成 ---
            const reportOptionsContainer = document.getElementById('report-options');
            reportData.forEach(item => {
                const label = document.createElement('label');
                label.className = 'flex items-center p-3 rounded-lg hover:bg-[#E4C1B5]/20 transition-colors duration-300';
                label.innerHTML = `
                    <input type="radio" id="${item.id}" name="report-type" value="${item.value}" data-name="${item.name}" class="h-5 w-5 border-gray-300 text-[#ad9196] focus:ring-[#ad9196]">
                    <span class="ml-3">${item.name} <span class="font-semibold ml-2">${item.description}</span></span>
                `;
                reportOptionsContainer.appendChild(label);
            });
            
            // --- 計算関数 ---
            const calculateTotal = () => {
                let total = 0;
                let quoteText = "【ヒーリングお見積り】\n\n";

                // メニュー
                const selectedMenus = form.querySelectorAll('input[name="menu"]:checked');
                if (selectedMenus.length === 0) {
                    quoteText += "ヒーリングメニュー：選択されていません\n";
                } else {
                     selectedMenus.forEach(menu => {
                        const price = parseInt(menu.value);
                        total += price;
                        quoteText += `${menu.dataset.name}：${price.toLocaleString()} 円\n`;
                    });
                }
               

                // 報告書
                const selectedReport = form.querySelector('input[name="report-type"]:checked');
                if (selectedReport) {
                    const price = parseInt(selectedReport.value);
                    total += price;
                    quoteText += `${selectedReport.dataset.name}：${price.toLocaleString()} 円\n`;

                    // お体のご相談 追加料金
                    if (selectedReport.dataset.name === 'お体のご相談') {
                        const extraCount = parseInt(form.querySelector('#body-consult-count').value) || 0;
                        if(extraCount > 0){
                            const extraCharge = extraCount * 3000;
                            total += extraCharge;
                            quoteText += `　追加相談 ${extraCount}件：${extraCharge.toLocaleString()} 円\n`;
                        }
                    }
                }

                const subtotal = total;
                let couponDiscount = 0;
                
                // クーポン割引
                const couponValue = parseFloat(form.querySelector('#coupon').value);
                if (couponValue > 0) {
                    couponDiscount = Math.round(subtotal * couponValue);
                    total -= couponDiscount;
                    quoteText += `割引（クーポン）：-${couponDiscount.toLocaleString()} 円\n`;
                }

                // 紹介割引
                let referralDiscount = 0;
                if (isReferralApplied) {
                    referralDiscount = 500;
                    total -= referralDiscount;
                    quoteText += `割引（紹介割引）：-${referralDiscount.toLocaleString()} 円\n`;
                }
                
                // 合計
                quoteText += "\n--------------------------------\n";
                quoteText += `合計金額：${total.toLocaleString()} 円\n`;
                quoteText += "--------------------------------\n";

                // ご提出物
                if (visitCountSelect.value === 'first') {
                    quoteText += "\n【ご提出いただくもの】\n目元の写真\n手書きのお名前\n";
                }

                quoteOutput.textContent = quoteText;
            };

            // --- バリデーション関数 ---
            const validateForm = () => {
                const report = form.querySelector('input[name="report-type"]:checked');
                const payment = form.querySelector('#payment-method').value;
                let errors = [];

                // Reset styles
                reportOptionsContainer.classList.remove('border-error', 'border-2', 'rounded-lg', 'p-2');
                form.querySelector('#payment-method').classList.remove('border-error');

                if (!report) {
                    errors.push('報告タイプを選択してください。');
                    reportOptionsContainer.classList.add('border-error', 'border-2', 'rounded-lg', 'p-2');
                }
                if (!payment) {
                    errors.push('お支払い方法を選択してください。');
                    form.querySelector('#payment-method').classList.add('border-error');
                }
                
                if (errors.length > 0) {
                    showModal(errors.join('\n'));
                    return false;
                }
                return true;
            };
            
            // --- モーダル表示/非表示 ---
            const showModal = (message) => {
                modalMessage.textContent = message;
                modalOverlay.classList.add('visible');
            };
            const hideModal = () => {
                modalOverlay.classList.remove('visible');
            };

            // --- イベントリスナー ---
            form.addEventListener('input', calculateTotal);

            referralButton.addEventListener('click', () => {
                isReferralApplied = !isReferralApplied;
                if (isReferralApplied) {
                    referralButton.textContent = '追加済み (-500円)';
                    referralButton.classList.remove('bg-button');
                    referralButton.classList.add('bg-green-500');
                } else {
                    referralButton.textContent = '追加する';
                    referralButton.classList.add('bg-button');
                    referralButton.classList.remove('bg-green-500');
                }
                calculateTotal();
            });

            form.addEventListener('change', (e) => {
                if(e.target.name === 'report-type') {
                    const selectedReport = form.querySelector('input[name="report-type"]:checked');
                    if (selectedReport && selectedReport.dataset.name === 'お体のご相談') {
                        bodyConsultExtra.style.display = 'block';
                    } else {
                        bodyConsultExtra.style.display = 'none';
                        form.querySelector('#body-consult-count').value = 0;
                    }
                    calculateTotal();
                }
            });
            
            visitCountSelect.addEventListener('change', () => {
                submissionInfo.style.display = visitCountSelect.value === 'first' ? 'block' : 'none';
                calculateTotal();
            });

            clearButton.addEventListener('click', () => {
                form.reset();
                isReferralApplied = false;
                referralButton.textContent = '追加する';
                referralButton.classList.add('bg-button');
                referralButton.classList.remove('bg-green-500');
                bodyConsultExtra.style.display = 'none';
                submissionInfo.style.display = 'block'; // デフォルト表示に戻す
                 // Reset error styles
                reportOptionsContainer.classList.remove('border-error', 'border-2', 'rounded-lg', 'p-2');
                form.querySelector('#payment-method').classList.remove('border-error');
                calculateTotal();
            });

            copyButton.addEventListener('click', () => {
                if (!validateForm()) return;
                
                // テキストエリアを作成してコピー
                const textarea = document.createElement('textarea');
                textarea.textContent = quoteOutput.textContent;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    showModal('お見積もり内容をコピーしました！');
                } catch (err) {
                    showModal('コピーに失敗しました。');
                }
                document.body.removeChild(textarea);
            });
            
            lineButton.addEventListener('click', () => {
                if (!validateForm()) return;
                window.open('https://line.me/ti/p/Kv76GQK_UI', '_blank');
            });

            modalClose.addEventListener('click', hideModal);
            modalOverlay.addEventListener('click', (e) => {
                if (e.target === modalOverlay) {
                    hideModal();
                }
            });


            // --- 初期化 ---
            visitCountSelect.dispatchEvent(new Event('change')); // 初回表示
            calculateTotal(); // 初期計算
        });
    </script>
</body>
</html>
