<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ヒーリングお見積り＆ご予約</title>
    <link rel="icon" href="https://github.com/therapist-mii/spiritual/raw/main/images/favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --text-color: #776163;
            --main-btn-bg: #E4C1B5;
            --main-btn-hover-bg: #ad9196;
            --main-btn-text-hover: white;
            --first-timer-btn-bg: #e4b5b9;
            --clear-btn-bg: #7a736a;
            --clear-btn-text: white;
            --clear-btn-hover-bg: #E4C1B5;
            --clear-btn-x-text: #EAE6E1;
            --clear-btn-x-hover-text: #cbb6b6;
            --error-color: #ff0000;
        }

        body {
            font-family: 'Noto Serif JP', serif;
            color: var(--text-color);
            background-color: #F8F6F4;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .header-logo {
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 1rem;
        }

        h1, h2, h3 {
            color: var(--text-color);
        }

        h2 {
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-top: 2rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--text-color);
            padding-bottom: 0.5rem;
        }

        .form-section {
            background-color: #fcfcfc;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
            animation: fadeIn 0.8s ease-out;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            outline: none;
            background-color: #fff;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            border-color: var(--main-btn-bg);
            box-shadow: 0 0 0 2px rgba(228, 193, 181, 0.5);
        }

        .form-input.error, .form-select.error, .form-textarea.error {
            border-color: var(--error-color);
            box-shadow: 0 0 0 2px rgba(255, 0, 0, 0.2);
        }

        .radio-group label {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: color 0.3s ease;
            font-size: 0.95rem;
        }

        .radio-group input[type="radio"] {
            margin-right: 0.5rem;
        }

        .btn-base {
            padding: 1rem 1.5rem;
            border-radius: 9999px;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-main {
            background-color: var(--main-btn-bg);
            color: white;
        }

        .btn-main:hover {
            background-color: var(--main-btn-hover-bg);
            color: var(--main-btn-text-hover);
            box-shadow: 0 6px 15px rgba(173, 145, 150, 0.3);
        }

        .btn-first-timer {
            background-color: var(--first-timer-btn-bg);
            color: white;
        }

        .btn-first-timer:hover {
            background-color: var(--main-btn-hover-bg);
            color: var(--main-btn-text-hover);
            box-shadow: 0 6px 15px rgba(173, 145, 150, 0.3);
        }

        .btn-clear {
            background-color: var(--clear-btn-bg);
            color: var(--clear-btn-text);
        }

        .btn-clear:hover {
            background-color: var(--clear-btn-hover-bg);
            color: white;
            box-shadow: 0 6px 15px rgba(228, 193, 181, 0.3);
        }

        .btn-clear span.x-mark {
            color: var(--clear-btn-x-text);
            font-size: 1.25rem;
            font-weight: 700;
            transition: color 0.3s ease;
        }

        .btn-clear:hover span.x-mark {
            color: var(--clear-btn-x-hover-text);
        }

        .required-asterisk {
            color: var(--error-color);
        }

        .line {
            border-top: 1px solid #E4C1B5;
            margin: 1.5rem 0;
        }

        .footer-logo {
            opacity: 0.8;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.05));
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            transition: opacity 0.3s ease;
            opacity: 0;
            visibility: hidden;
        }

        .modal.is-active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal.is-active .modal-content {
            transform: scale(1);
        }
    </style>
</head>
<body class="bg-[#F8F6F4]">
    <header class="bg-[#EAE6E1] py-4 shadow-sm">
        <div class="container flex justify-center items-center">
            <a href="https://spiritual-therapist-mii.studio.site/" target="_blank">
                <img src="https://github.com/therapist-mii/spiritual/raw/main/images/rogo-250.png" alt="Mii Spiritual Therapist Logo" class="header-logo w-auto h-12 md:h-16">
            </a>
        </div>
    </header>

    <main class="flex-grow container">
        <h2 class="text-3xl md:text-4xl text-center font-bold mt-8 mb-4 tracking-wider">ヒーリングお見積り＆ご予約</h2>

        <form id="healingForm" class="form-section">
            <!-- メニュー選択 -->
            <h3>メニュー選択</h3>
            <p class="mb-4 text-sm md:text-base">ご希望のメニューを選択してください。</p>
            <div class="mb-6">
                <div class="relative">
                    <select id="menuSelect" class="form-select border-2 bg-white appearance-none" required>
                        <option value="">メニューを選択してください</option>
                        <option value="おまかせヒーリング">おまかせヒーリング 30分 5,000円</option>
                        <option value="メンタルヒーリング">メンタルヒーリング 30分 5,000円</option>
                        <option value="エネルギートリートメント">エネルギートリートメント 30分 5,000円</option>
                        <option value="ヘッドヒーリング">ヘッドヒーリング 30分 5,000円</option>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                        <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                    </div>
                </div>
            </div>

            <!-- ご利用回数 -->
            <h3>当サロンご利用回数</h3>
            <p class="mb-4 text-sm md:text-base">当サロンのご利用回数を選択してください。</p>
            <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4 mb-6">
                <label class="inline-flex items-center text-sm md:text-base">
                    <input type="radio" name="usageCount" value="はじめて" class="form-radio text-[#ad9196] w-4 h-4" checked>
                    <span class="ml-2">はじめて</span>
                </label>
                <label class="inline-flex items-center text-sm md:text-base">
                    <input type="radio" name="usageCount" value="2回以上" class="form-radio text-[#ad9196] w-4 h-4">
                    <span class="ml-2">2回以上</span>
                </label>
            </div>

            <!-- 報告書選択 -->
            <h3>報告書タイプを選択してください<span class="required-asterisk">*</span></h3>
            <p class="mb-4 text-sm md:text-base">ご希望の報告タイプを選択してください。</p>
            <div class="radio-group mb-4" id="reportTypeRadioGroup">
                <label class="block mb-2">
                    <input type="radio" name="reportType" value="報告不要" data-price="0" class="form-radio text-[#ad9196]">
                    <span class="ml-2">報告不要: 0円</span>
                </label>
                <label class="block mb-2">
                    <input type="radio" name="reportType" value="ミニ報告" data-price="2000" class="form-radio text-[#ad9196]">
                    <span class="ml-2">ミニ報告: 2,000円</span>
                </label>
                <label class="block mb-2">
                    <input type="radio" name="reportType" value="1部位鑑定書" data-price="5000" class="form-radio text-[#ad9196]">
                    <span class="ml-2">1部位鑑定書: 5,000円</span>
                </label>
                <label class="block mb-2">
                    <input type="radio" name="reportType" value="鑑定書" data-price="15000" class="form-radio text-[#ad9196]">
                    <span class="ml-2">鑑定書: 15,000円</span>
                </label>
                <label class="block mb-2">
                    <input type="radio" name="reportType" value="オーラアート" data-price="15000" class="form-radio text-[#ad9196]">
                    <span class="ml-2">オーラアート: 15,000円</span>
                </label>
                <label class="block mb-2">
                    <input type="radio" name="reportType" value="鑑定書＋オーラアート" data-price="20000" class="form-radio text-[#ad9196]">
                    <span class="ml-2">鑑定書＋オーラアート: 20,000円</span>
                </label>
                <label class="block mb-2">
                    <input type="radio" name="reportType" value="お体のご相談" data-price="16000" class="form-radio text-[#ad9196]">
                    <span class="ml-2">お体のご相談: 16,000円 （ご相談1件追加ごとに3,000円）</span>
                </label>
            </div>
            <div id="additionalConsultation" class="mb-6 hidden">
                <p class="text-sm md:text-base mb-2">追加相談件数<span class="required-asterisk">*</span></p>
                <input type="number" id="additionalConsultationCount" class="form-input" min="0" value="0">
            </div>

            <!-- お支払いについて -->
            <h3>お支払いについて</h3>
            <div class="mb-6">
                <!-- 割引 -->
                <h4 class="font-bold mb-2">割引</h4>
                <div class="mb-4">
                    <p class="text-sm md:text-base">クーポンをお持ちの方は選択してください。</p>
                    <div class="relative mt-2">
                        <select id="couponSelect" class="form-select border-2 appearance-none">
                            <option value="0">選択してください</option>
                            <option value="0">クーポン無し</option>
                            <option value="0.05">5％OFFクーポン</option>
                            <option value="0.10">10％OFFクーポン</option>
                            <option value="0.15">15％OFFクーポン</option>
                            <option value="0.20">20％OFFクーポン</option>
                            <option value="0.25">25％OFFクーポン</option>
                            <option value="0.30">30％OFFクーポン</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                            <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                        </div>
                    </div>
                </div>
                <div>
                    <p class="text-sm md:text-base">ご紹介くださった方と紹介された方を対象に割引できます。他クーポン併用可 紹介割引：−500円</p>
                    <button type="button" id="referralDiscountBtn" class="btn-base btn-main w-full md:w-auto mt-2 text-sm">
                        <span>紹介割引を追加する</span>
                    </button>
                </div>
            </div>

            <div class="mb-6">
                <!-- お支払い方法 -->
                <h4 class="font-bold mb-2">お支払い方法<span class="required-asterisk">*</span></h4>
                <div class="relative">
                    <select id="paymentMethodSelect" class="form-select border-2 appearance-none" required>
                        <option value="">選択してください</option>
                        <option value="銀行振込">銀行振込</option>
                        <option value="Paypay">Paypay</option>
                        <option value="Paypal">Paypal</option>
                        <option value="クレジットカード">クレジットカード</option>
                        <option value="コンビニ払い">コンビニ払い（手数料220円）</option>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                        <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                    </div>
                </div>
            </div>

            <!-- 備考 -->
            <h3>備考</h3>
            <p class="mb-4 text-sm md:text-base">ご要望やご質問などございましたら、ご自由にご記入ください。</p>
            <textarea id="notes" class="form-textarea h-24" placeholder="ご入力ください"></textarea>
        </form>

        <!-- ご確認事項 -->
        <div class="form-section">
            <h3>ご確認事項</h3>
            <div class="p-4 bg-gray-50 rounded-lg">
                <h4 class="font-bold mb-2">セッションについて</h4>
                <ul class="list-disc list-inside text-sm">
                    <li>セッション形式： 遠隔</li>
                    <li>ご予約： 日にち指定のみ（時間指定不可）</li>
                </ul>
                <h4 class="font-bold mt-4 mb-2">納品日・営業時間</h4>
                <ul class="list-disc list-inside text-sm">
                    <li>納品日：セッション日より5営業日</li>
                    <li>営業時間： 9：00～17：00</li>
                    <li>休日：土日祝日、他指定日</li>
                </ul>
                <h4 class="font-bold mt-4 mb-2">セッション後の追加料金について</h4>
                <p class="text-sm">納品後に、追加の相談がある場合、追加料金が発生いたします。</p>
                <ul class="list-disc list-inside text-sm">
                    <li>ご相談１件：3,000円～</li>
                </ul>
            </div>
        </div>

        <!-- ご提出いただくもの -->
        <div class="form-section">
            <h3>【ご提出いただくもの】</h3>
            <p class="mb-4 text-sm md:text-base">セッション開始までにご提出ください。</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="flex flex-col items-center text-center">
                    <img src="https://github.com/therapist-mii/spiritual/raw/main/images/memoto.jpg" alt="目元の写真" class="w-full rounded-lg mb-2">
                    <p class="text-sm">目元の写真</p>
                </div>
                <div class="flex flex-col items-center text-center">
                    <img src="https://github.com/therapist-mii/spiritual/raw/main/images/tegaki-r.jpg" alt="手書きのお名前" class="w-full rounded-lg mb-2">
                    <p class="text-sm">手書きのお名前</p>
                </div>
                <div class="flex flex-col items-center text-center">
                    <p class="text-sm">手書きの相談のタイトル</p>
                </div>
            </div>
        </div>

        <!-- 自動計算とお見積もり内容 -->
        <div class="form-section">
            <h3>お見積り内容</h3>
            <p class="mb-4 text-sm md:text-base">入力内容に合わせて金額が自動で計算されます。</p>
            <div id="quotationOutput" class="p-6 bg-[#f5f5f5] rounded-lg border border-[#e4c1b5] mb-6 whitespace-pre-line">
                <div class="flex justify-center items-center h-20 text-gray-400">
                    <span id="initialMessage">フォームに情報を入力してください。</span>
                </div>
            </div>
        </div>

        <!-- ボタンセクション -->
        <div class="flex flex-col md:flex-row md:justify-center md:space-x-4 space-y-4 md:space-y-0 mb-8">
            <button type="button" id="clearBtn" class="btn-base btn-clear font-bold text-sm">
                <span class="x-mark mr-2 text-2xl font-normal leading-none">&times;</span>
                フォームをクリアする
            </button>
            <button type="button" id="copyBtn" class="btn-base btn-main font-bold text-sm">お見積り内容をコピーする</button>
            <button type="button" id="lineBtn" class="btn-base btn-main font-bold text-sm">LINEに貼り付けて予約する</button>
        </div>
        <div class="text-center mb-10">
            <p class="text-xs text-gray-500 mb-2">【LINEで予約する際の手順】</p>
            <p class="text-xs text-gray-500">① お見積り内容にご了承いただけましたら、コピーボタンを押し、お見積り内容をコピーしてください。</p>
            <p class="text-xs text-gray-500">② 「LINEに貼り付けて予約する」ボタンを押し、起動したLINEに貼り付けて送信ください。</p>
        </div>
    </main>

    <footer class="bg-[#F3EFEA] py-8 text-center mt-auto">
        <div class="container">
            <!-- はじめての方へ -->
            <div class="mb-8">
                <h3 class="font-bold text-2xl mb-4 border-b-0">はじめての方へ</h3>
                <p class="text-sm max-w-lg mx-auto mb-4">
                    はじめての方は、以下のフォームにご記入お願いいたします。<br>リピーター様も未入力の方はご記入お願いいたします。
                </p>
                <a href="https://spiritual-therapist-mii.studio.site/form" class="btn-base btn-first-timer inline-block text-sm">
                    はじめての方のフォーム
                </a>
            </div>
            <!-- メニューリンク -->
            <div class="mb-8 flex justify-center space-x-6 text-sm font-bold">
                <a href="https://spiritual-therapist-mii.studio.site/" class="hover:text-[#ad9196] transition-colors">Home</a>
                <a href="https://spiritual-therapist-mii.studio.site/menu" class="hover:text-[#ad9196] transition-colors">メニュー一覧</a>
            </div>
            <!-- フッターロゴ -->
            <div class="flex justify-center">
                <a href="https://spiritual-therapist-mii.studio.site/">
                    <img src="https://github.com/therapist-mii/spiritual/raw/main/images/rogo-250.png" alt="Mii Spiritual Therapist Logo" class="footer-logo w-32 md:w-48">
                </a>
            </div>
        </div>
    </footer>

    <!-- カスタムモーダル -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <p id="modalMessage" class="text-lg mb-4"></p>
            <button id="closeModal" class="btn-base btn-main w-full">OK</button>
        </div>
    </div>

    <script defer>
        document.addEventListener('DOMContentLoaded', () => {
            // 変数宣言
            const form = document.getElementById('healingForm');
            const menuSelect = document.getElementById('menuSelect');
            const reportTypeRadioGroup = document.getElementById('reportTypeRadioGroup');
            const additionalConsultationSection = document.getElementById('additionalConsultation');
            const additionalConsultationCount = document.getElementById('additionalConsultationCount');
            const couponSelect = document.getElementById('couponSelect');
            const referralDiscountBtn = document.getElementById('referralDiscountBtn');
            const paymentMethodSelect = document.getElementById('paymentMethodSelect');
            const quotationOutput = document.getElementById('quotationOutput');
            const initialMessage = document.getElementById('initialMessage');
            const clearBtn = document.getElementById('clearBtn');
            const copyBtn = document.getElementById('copyBtn');
            const lineBtn = document.getElementById('lineBtn');
            const modal = document.getElementById('modal');
            const modalMessage = document.getElementById('modalMessage');
            const closeModalBtn = document.getElementById('closeModal');
            
            let isReferralDiscountApplied = false;

            // 価格データ
            const menuPrices = {
                "おまかせヒーリング": 5000,
                "メンタルヒーリング": 5000,
                "エネルギートリートメント": 5000,
                "ヘッドヒーリング": 5000
            };
            const referralDiscount = 500;
            const additionalConsultationPrice = 3000;

            // リアルタイムでお見積もりを更新する関数
            const updateQuotation = () => {
                let total = 0;
                let details = "【ヒーリングお見積り】\n\n";
                let discountText = "";
                let paymentFeeText = "";

                // メニュー料金計算
                const selectedMenu = menuSelect.value;
                const menuPrice = menuPrices[selectedMenu] || 0;
                if (selectedMenu) {
                    total += menuPrice;
                    details += `${selectedMenu}：${menuPrice.toLocaleString()} 円\n`;
                }

                // 報告書料金計算
                const selectedReport = document.querySelector('input[name="reportType"]:checked');
                let reportPrice = 0;
                let reportName = "";
                if (selectedReport) {
                    reportPrice = parseInt(selectedReport.dataset.price);
                    reportName = selectedReport.value;
                    total += reportPrice;
                    details += `${reportName}：${reportPrice.toLocaleString()} 円\n`;

                    if (reportName === "お体のご相談") {
                        const count = parseInt(additionalConsultationCount.value);
                        if (count > 0) {
                            const addOnPrice = count * additionalConsultationPrice;
                            total += addOnPrice;
                            details += `追加相談 (${count}件)：${addOnPrice.toLocaleString()} 円\n`;
                        }
                    }
                }

                // 割引計算
                let totalDiscount = 0;
                const couponRate = parseFloat(couponSelect.value);
                let couponDiscountAmount = 0;
                if (couponRate > 0) {
                    couponDiscountAmount = Math.floor(total * couponRate);
                    totalDiscount += couponDiscountAmount;
                    discountText += `割引（クーポン）：-${couponDiscountAmount.toLocaleString()} 円\n`;
                }

                if (isReferralDiscountApplied) {
                    totalDiscount += referralDiscount;
                    discountText += `割引（紹介割引）：-${referralDiscount.toLocaleString()} 円\n`;
                }

                total -= totalDiscount;

                // お支払い方法の表示（手数料は加算しない）
                const paymentMethod = paymentMethodSelect.value;
                if (paymentMethod === "コンビニ払い") {
                    paymentFeeText = `\nお支払い方法：${paymentMethod}（手数料220円）\n`;
                } else if (paymentMethod) {
                    paymentFeeText = `\nお支払い方法：${paymentMethod}\n`;
                }

                // 全てが空の場合は初期メッセージを表示
                if (!selectedMenu && !selectedReport && !couponSelect.value && !isReferralDiscountApplied && !paymentMethodSelect.value) {
                    initialMessage.classList.remove('hidden');
                    quotationOutput.textContent = "";
                    return;
                }
                
                initialMessage.classList.add('hidden');

                // 出力内容を整形
                let output = details;
                if (discountText) {
                    output += "\n" + discountText;
                }
                if (paymentFeeText) {
                    output += paymentFeeText;
                }
                
                output += `--------------------------------\n`
                output += `合計金額：${Math.max(0, total).toLocaleString()} 円\n`
                output += `--------------------------------\n\n`
                output += `【ご提出いただくもの】\n`
                output += `目元の写真\n`
                output += `手書きのお名前\n`

                quotationOutput.textContent = output;
            };

            // 報告書タイプの変更イベント
            reportTypeRadioGroup.addEventListener('change', () => {
                const selectedReport = document.querySelector('input[name="reportType"]:checked').value;
                if (selectedReport === "お体のご相談") {
                    additionalConsultationSection.classList.remove('hidden');
                } else {
                    additionalConsultationSection.classList.add('hidden');
                    additionalConsultationCount.value = "0";
                }
                updateQuotation();
            });

            // フォーム入力変更時のイベントリスナー
            form.addEventListener('change', updateQuotation);
            form.addEventListener('input', updateQuotation);

            // 紹介割引ボタンのクリックイベント
            referralDiscountBtn.addEventListener('click', (e) => {
                e.preventDefault();
                isReferralDiscountApplied = !isReferralDiscountApplied;
                referralDiscountBtn.textContent = isReferralDiscountApplied ? "紹介割引を解除する" : "紹介割引を追加する";
                referralDiscountBtn.classList.toggle('btn-main', !isReferralDiscountApplied);
                referralDiscountBtn.classList.toggle('bg-[#ad9196]', isReferralDiscountApplied);
                referralDiscountBtn.classList.toggle('text-white', isReferralDiscountApplied);
                updateQuotation();
            });

            // クリアボタンのクリックイベント
            clearBtn.addEventListener('click', () => {
                form.reset();
                isReferralDiscountApplied = false;
                referralDiscountBtn.textContent = "紹介割引を追加する";
                referralDiscountBtn.classList.remove('bg-[#ad9196]', 'text-white');
                referralDiscountBtn.classList.add('btn-main');
                additionalConsultationSection.classList.add('hidden');
                additionalConsultationCount.value = "0";
                updateQuotation();
            });

            // バリデーション関数
            const validateForm = () => {
                let isValid = true;
                const requiredFields = [menuSelect, paymentMethodSelect];
                const reportRadioButtons = document.querySelectorAll('input[name="reportType"]');
                const isReportSelected = Array.from(reportRadioButtons).some(radio => radio.checked);
                
                if (!isReportSelected) {
                    // ラジオボタンのどれも選択されていない場合、最初のラジオボタンのグループをエラーとしてマーク
                    document.querySelector('.radio-group').style.border = `1px solid var(--error-color)`;
                    document.querySelector('.radio-group').style.borderRadius = `0.5rem`;
                    document.querySelector('.radio-group').style.padding = `0.25rem`;
                    isValid = false;
                } else {
                    document.querySelector('.radio-group').style.border = `none`;
                    document.querySelector('.radio-group').style.padding = `0`;
                }

                requiredFields.forEach(field => {
                    if (!field.value) {
                        field.classList.add('error');
                        isValid = false;
                    } else {
                        field.classList.remove('error');
                    }
                });

                const selectedReportValue = document.querySelector('input[name="reportType"]:checked')?.value;
                if (selectedReportValue === "お体のご相談") {
                    if (parseInt(additionalConsultationCount.value) < 0 || isNaN(parseInt(additionalConsultationCount.value))) {
                        additionalConsultationCount.classList.add('error');
                        isValid = false;
                    } else {
                        additionalConsultationCount.classList.remove('error');
                    }
                }
                
                return isValid;
            };

            // コピーボタンのクリックイベント
            copyBtn.addEventListener('click', (e) => {
                e.preventDefault();
                if (validateForm()) {
                    const tempTextarea = document.createElement('textarea');
                    tempTextarea.value = quotationOutput.textContent;
                    document.body.appendChild(tempTextarea);
                    tempTextarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempTextarea);
                    showModal("お見積り内容をコピーしました！");
                } else {
                    showModal("必須項目をすべて入力してください。");
                }
            });

            // LINEボタンのクリックイベント
            lineBtn.addEventListener('click', (e) => {
                e.preventDefault();
                if (validateForm()) {
                    window.location.href = "https://line.me/ti/p/Kv76GQK_UI";
                } else {
                    showModal("必須項目をすべて入力してください。");
                }
            });

            // カスタムモーダル表示関数
            const showModal = (message) => {
                modalMessage.textContent = message;
                modal.classList.add('is-active');
            };

            // カスタムモーダル非表示イベント
            closeModalBtn.addEventListener('click', () => {
                modal.classList.remove('is-active');
            });
        });
    </script>
</body>
</html>
