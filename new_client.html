<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>はじめての方フォーム</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Homemade+Apple&family=Noto+Serif+JP:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --error-color: #ff0000;
            --add-button-color: #ad9196;
            --add-button-hover-color: #E4C1B5;
            --add-button-text-color: #fff;
            --main-button-color: #E4C1B5;
            --main-button-hover-color: #ad9196;
            --main-button-hover-text-color: #fff;
            --text-color: #544C40;
            --clear-button-color: #EAE6E1;
            --clear-button-text-color: #cbb6b6;
            --clear-button-hover-color: #cbb6b6;
            --clear-button-hover-text-color: #EAE6E1;
            --english-text-color: #f0e2e3;
        }

        body {
            font-family: 'Noto Serif JP', serif;
            color: var(--text-color);
            background-color: #fff;
            background-image: url('https://github.com/therapist-mii/spiritual/raw/main/images/haikei-sumaho.jpg');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
        }

        @media (min-width: 768px) {
            body {
                background-image: url('https://github.com/therapist-mii/spiritual/raw/main/images/haikei.jpg');
            }
        }

        h1, h2, h3 {
            font-weight: 700;
        }

        .homemade-apple {
            font-family: 'Homemade Apple', cursive;
            color: var(--english-text-color);
        }

        .required-label::after {
            content: '*';
            color: var(--error-color);
            margin-left: 4px;
        }

        .input-error {
            border-color: var(--error-color) !important;
            box-shadow: 0 0 0 1px var(--error-color);
        }

        .main-button {
            background-color: var(--main-button-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        .main-button:hover {
            background-color: var(--main-button-hover-color);
            color: var(--main-button-hover-text-color);
        }

        .add-button {
            background-color: var(--add-button-color);
            color: var(--add-button-text-color);
            transition: background-color 0.3s;
        }

        .add-button:hover {
            background-color: var(--add-button-hover-color);
        }
        
        .clear-button {
            background-color: var(--clear-button-color);
            color: var(--clear-button-text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        .clear-button:hover {
            background-color: var(--clear-button-hover-color);
            color: var(--clear-button-hover-text-color);
        }

        .nav-button {
            background-color: var(--main-button-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        .nav-button:hover {
            background-color: var(--main-button-hover-color);
            color: var(--main-button-hover-text-color);
        }
    </style>
</head>
<body class="p-4 md:p-8 flex flex-col items-center min-h-screen">

    <main class="w-full max-w-2xl bg-white bg-opacity-80 backdrop-blur-md rounded-lg p-6 md:p-10 shadow-2xl space-y-8">
        <!-- Header -->
        <div class="text-center">
            <a href="https://spiritual-therapist-mii.studio.site/">
                <img src="https://github.com/therapist-mii/spiritual/raw/main/images/rogo-250.png" alt="セラピスト未依ロゴ" class="mx-auto w-40 md:w-64 rounded-md">
            </a>
            <h1 class="text-3xl md:text-4xl mt-6 font-bold">はじめての方フォーム</h1>
            <p class="homemade-apple text-sm md:text-base mt-2">Nice to meet you! Thank you for finding me.</p>
            <p class="mt-4 text-base md:text-lg">はじめまして！<br>ご依頼ありがとうございます。<br>以下のフォームにご記入お願いいたします。</p>
            <p class="mt-4 text-sm md:text-base text-gray-600">営業時間　9：00～17：00<br>休日：土日祝日、他指定日</p>
        </div>

        <!-- Form Section -->
        <form id="contactForm" class="space-y-6">

            <!-- お名前 -->
            <div>
                <label for="name" class="block mb-2 required-label">お名前</label>
                <div class="relative flex items-center">
                    <input type="text" id="name" name="name" required class="w-full px-4 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:border-main-button-color">
                </div>
            </div>

            <!-- ふりがな -->
            <div>
                <label for="furigana" class="block mb-2 required-label">ふりがな</label>
                <div class="relative flex items-center">
                    <input type="text" id="furigana" name="furigana" required class="w-full px-4 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:border-main-button-color">
                </div>
            </div>

            <!-- 生年月日 -->
            <div>
                <label class="block mb-2 required-label">生年月日</label>
                <div class="grid grid-cols-3 gap-4">
                    <select id="birthYear" name="birthYear" required class="w-full px-4 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:border-main-button-color"></select>
                    <select id="birthMonth" name="birthMonth" required class="w-full px-4 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:border-main-button-color"></select>
                    <select id="birthDay" name="birthDay" required class="w-full px-4 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:border-main-button-color"></select>
                </div>
            </div>

            <!-- 性別 -->
            <div>
                <label class="block mb-2 required-label">性別</label>
                <div class="flex flex-wrap gap-4 items-center">
                    <label class="flex items-center">
                        <input type="radio" name="gender" value="女性" required class="mr-2 accent-[var(--main-button-color)]"> 女性
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="gender" value="男性" class="mr-2 accent-[var(--main-button-color)]"> 男性
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="gender" value="その他" id="genderOtherRadio" class="mr-2 accent-[var(--main-button-color)]"> その他
                    </label>
                    <input type="text" id="genderOtherText" name="genderOtherText" placeholder="その他" class="flex-grow px-4 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:border-main-button-color hidden">
                </div>
            </div>

            <!-- お住いの都道府県 -->
            <div>
                <label for="prefecture" class="block mb-2 required-label">お住いの都道府県</label>
                <select id="prefecture" name="prefecture" required class="w-full px-4 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:border-main-button-color">
                    <option value="">選択してください</option>
                </select>
            </div>

            <!-- お住いの市町村 -->
            <div>
                <label for="city" class="block mb-2 required-label">お住いの市町村</label>
                <div class="relative flex items-center">
                    <input type="text" id="city" name="city" required class="w-full px-4 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:border-main-button-color">
                </div>
            </div>

            <!-- 旧姓（任意） -->
            <div id="maidenNameContainer">
                <label for="maidenName" class="block mb-2">ご結婚されている方は旧姓</label>
                <div class="relative flex items-center">
                    <input type="text" id="maidenName" name="maidenName" class="w-full px-4 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:border-main-button-color">
                    <button type="button" class="clear-button absolute right-2 w-8 h-8 rounded-full font-bold text-lg leading-none flex items-center justify-center transition-opacity opacity-0" aria-label="旧姓をクリア">×</button>
                </div>
            </div>

            <!-- 同居のご家族構成と年齢（任意） -->
            <div>
                <p class="block mb-2">同居のご家族構成と年齢</p>
                <div id="familyMembers" class="space-y-4">
                    <div class="flex gap-2 items-end">
                        <div class="flex-1">
                            <label class="block text-sm text-gray-500">関係性</label>
                            <input type="text" name="familyRelation[]" placeholder="例：夫" class="w-full px-4 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:border-main-button-color">
                        </div>
                        <div class="flex-1">
                            <label class="block text-sm text-gray-500">年齢</label>
                            <input type="text" name="familyAge[]" class="w-full px-4 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:border-main-button-color">
                        </div>
                        <button type="button" class="clear-button w-8 h-8 rounded-full font-bold text-lg leading-none flex items-center justify-center opacity-0 transition-opacity" aria-label="家族をクリア">×</button>
                    </div>
                </div>
                <button type="button" id="addFamilyButton" class="add-button w-full mt-4 py-2 px-4 rounded-md font-bold">＋ 家族を追加</button>
            </div>

            <!-- 職務内容 -->
            <div>
                <label for="jobTitle" class="block mb-2 required-label">職務内容</label>
                <div class="relative flex items-center">
                    <input type="text" id="jobTitle" name="jobTitle" required class="w-full px-4 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:border-main-button-color">
                </div>
            </div>

            <!-- ご紹介者（任意） -->
            <div id="introducerContainer">
                <label for="introducer" class="block mb-2">ご紹介の方は紹介者のお名前</label>
                <div class="relative flex items-center">
                    <input type="text" id="introducer" name="introducer" class="w-full px-4 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:border-main-button-color">
                    <button type="button" class="clear-button absolute right-2 w-8 h-8 rounded-full font-bold text-lg leading-none flex items-center justify-center transition-opacity opacity-0" aria-label="紹介者をクリア">×</button>
                </div>
            </div>

            <!-- お知りになったきっかけ（任意） -->
            <div id="triggerContainer">
                <label for="trigger" class="block mb-2">『セラピスト未依』は何でお知りになりましたか？</label>
                <div class="relative flex items-center">
                    <input type="text" id="trigger" name="trigger" class="w-full px-4 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:border-main-button-color">
                    <button type="button" class="clear-button absolute right-2 w-8 h-8 rounded-full font-bold text-lg leading-none flex items-center justify-center transition-opacity opacity-0" aria-label="きっかけをクリア">×</button>
                </div>
            </div>

            <!-- Input Confirmation Section -->
            <div class="border-t-2 border-gray-300 pt-6 mt-8">
                <h2 class="text-2xl font-bold mb-4">ご入力内容</h2>
                <div id="confirmation-display" class="space-y-4 text-sm md:text-base">
                    <!-- 入力内容がここに表示されます -->
                    <p class="text-center text-gray-500">フォームにご入力いただくと、ここに内容が表示されます。</p>
                </div>
            </div>

            <!-- Buttons -->
            <div class="flex flex-col gap-4 mt-8">
                <button type="submit" id="submitButton" class="main-button w-full py-3 rounded-md text-lg font-bold shadow-md hover:shadow-lg">送信</button>
            </div>
            
        </form>

        <!-- Navigation Buttons -->
        <div class="flex flex-col md:flex-row gap-4 mt-8">
            <a href="https://spiritual-therapist-mii.studio.site/" class="nav-button w-full py-3 rounded-md text-center text-lg font-bold shadow-md hover:shadow-lg">Home</a>
            <a href="https://spiritual-therapist-mii.studio.site/menu" class="nav-button w-full py-3 rounded-md text-center text-lg font-bold shadow-md hover:shadow-lg">メニュー一覧</a>
        </div>
        
        <!-- Footer -->
        <div class="text-center mt-8">
            <a href="https://spiritual-therapist-mii.studio.site/">
                <img src="https://github.com/therapist-mii/spiritual/raw/main/images/rogo-250.png" alt="セラピスト未依ロゴ" class="mx-auto w-40 md:w-64 rounded-md">
            </a>
        </div>
    </main>
    
    <!-- Modal for validation error -->
    <div id="errorModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl text-center max-w-sm">
            <h3 class="text-2xl font-bold text-red-600 mb-4">エラー</h3>
            <p id="errorMessage" class="mb-6"></p>
            <button id="closeModalButton" class="main-button px-6 py-2 rounded-md font-bold">閉じる</button>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('contactForm');
            const submitButton = document.getElementById('submitButton');
            const confirmationDisplay = document.getElementById('confirmation-display');
            const errorModal = document.getElementById('errorModal');
            const errorMessage = document.getElementById('errorMessage');
            const closeModalButton = document.getElementById('closeModalButton');
            const familyMembersContainer = document.getElementById('familyMembers');
            const addFamilyButton = document.getElementById('addFamilyButton');

            // --- Google Apps Script (GAS) URL ---
            // 以下のURLを、ご自身のGoogle Apps Scriptで公開したWebアプリのURLに置き換えてください。
            // フォームから送信されたデータはこのURLにPOSTされます。
            const GAS_URL = "https://script.google.com/macros/s/AKfycbyJ2K0flrMhO7iqcaYYp5gEfJloFPmQkfQk9PaAMdKNrQ4zsGCVTBpjITW1ySBcLX47pw/exec";

            // 都道府県のリスト
            const prefectures = [
                '北海道', '青森県', '岩手県', '宮城県', '秋田県', '山形県', '福島県', '茨城県', '栃木県', '群馬県', '埼玉県', '千葉県', '東京都', '神奈川県',
                '新潟県', '富山県', '石川県', '福井県', '山梨県', '長野県', '岐阜県', '静岡県', '愛知県', '三重県', '滋賀県', '京都府', '大阪府', '兵庫県',
                '奈良県', '和歌山県', '鳥取県', '島根県', '岡山県', '広島県', '山口県', '徳島県', '香川県', '愛媛県', '高知県', '福岡県', '佐賀県', '長崎県',
                '熊本県', '大分県', '宮崎県', '鹿児島県', '沖縄県', 'その他'
            ];
            
            // 生年月日、都道府県のプルダウン生成
            const generateDateOptions = () => {
                const yearSelect = document.getElementById('birthYear');
                const monthSelect = document.getElementById('birthMonth');
                const daySelect = document.getElementById('birthDay');
                const currentYear = new Date().getFullYear();

                yearSelect.innerHTML = '<option value="">年</option>';
                for (let i = currentYear; i >= 1900; i--) {
                    yearSelect.innerHTML += `<option value="${i}">${i}</option>`;
                }

                monthSelect.innerHTML = '<option value="">月</option>';
                for (let i = 1; i <= 12; i++) {
                    monthSelect.innerHTML += `<option value="${i}">${i}</option>`;
                }

                daySelect.innerHTML = '<option value="">日</option>';
                for (let i = 1; i <= 31; i++) {
                    daySelect.innerHTML += `<option value="${i}">${i}</option>`;
                }
            };

            const generatePrefectureOptions = () => {
                const prefectureSelect = document.getElementById('prefecture');
                prefectures.forEach(pref => {
                    prefectureSelect.innerHTML += `<option value="${pref}">${pref}</option>`;
                });
            };

            generateDateOptions();
            generatePrefectureOptions();

            // 「その他」性別入力欄の表示/非表示
            document.querySelectorAll('input[name="gender"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    const genderOtherText = document.getElementById('genderOtherText');
                    if (document.getElementById('genderOtherRadio').checked) {
                        genderOtherText.classList.remove('hidden');
                        genderOtherText.setAttribute('required', 'required');
                    } else {
                        genderOtherText.classList.add('hidden');
                        genderOtherText.removeAttribute('required');
                        genderOtherText.value = '';
                    }
                });
            });

            // 任意項目のクリアボタン機能
            const setupClearButton = (containerId) => {
                const container = document.getElementById(containerId);
                const input = container.querySelector('input');
                const clearButton = container.querySelector('.clear-button');

                if (input && clearButton) {
                    input.addEventListener('input', () => {
                        clearButton.style.opacity = input.value.trim() ? '1' : '0';
                        clearButton.style.pointerEvents = input.value.trim() ? 'auto' : 'none';
                    });
                    
                    clearButton.addEventListener('click', () => {
                        input.value = '';
                        input.dispatchEvent(new Event('input'));
                    });
                }
            };
            setupClearButton('maidenNameContainer');
            setupClearButton('introducerContainer');
            setupClearButton('triggerContainer');

            // 家族構成の追加ボタン
            addFamilyButton.addEventListener('click', () => {
                const newMemberDiv = document.createElement('div');
                newMemberDiv.className = 'flex gap-2 items-end';
                newMemberDiv.innerHTML = `
                    <div class="flex-1">
                        <label class="block text-sm text-gray-500">関係性</label>
                        <input type="text" name="familyRelation[]" placeholder="例：夫" class="w-full px-4 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:border-main-button-color">
                    </div>
                    <div class="flex-1">
                        <label class="block text-sm text-gray-500">年齢</label>
                        <input type="text" name="familyAge[]" class="w-full px-4 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:border-main-button-color">
                    </div>
                    <button type="button" class="clear-button w-8 h-8 rounded-full font-bold text-lg leading-none flex items-center justify-center" aria-label="家族をクリア">×</button>
                `;
                familyMembersContainer.appendChild(newMemberDiv);

                const newClearButton = newMemberDiv.querySelector('.clear-button');
                newClearButton.addEventListener('click', () => {
                    newMemberDiv.remove();
                    updateConfirmationDisplay();
                });
                updateConfirmationDisplay();
            });

            // 全てのinput、select、textareaの変更を監視し、確認欄を更新
            const formElements = form.querySelectorAll('input, select, textarea');
            formElements.forEach(element => {
                element.addEventListener('input', updateConfirmationDisplay);
            });
            familyMembersContainer.addEventListener('input', updateConfirmationDisplay);

            // 入力内容確認の表示更新
            function updateConfirmationDisplay() {
                let html = '<ul class="space-y-2">';
                
                // Collect all form data
                const formData = new FormData(form);
                const data = {};
                for (let [key, value] of formData.entries()) {
                    // Collect all family members
                    if (key.includes('familyRelation') || key.includes('familyAge')) {
                        if (!data['家族構成']) {
                            data['家族構成'] = [];
                        }
                        const index = key.includes('Relation') ? Array.from(form.querySelectorAll('input[name="familyRelation[]"]')).indexOf(form.querySelector(`input[name="familyRelation[]"][value="${value}"]`)) : Array.from(form.querySelectorAll('input[name="familyAge[]"]')).indexOf(form.querySelector(`input[name="familyAge[]"][value="${value}"]`));
                        if (!data['家族構成'][index]) {
                            data['家族構成'][index] = {};
                        }
                        if (key.includes('Relation')) {
                            data['家族構成'][index]['関係性'] = value;
                        } else {
                            data['家族構成'][index]['年齢'] = value;
                        }
                    } else {
                        data[key] = value;
                    }
                }

                // Append the confirmation HTML
                const appendConfirmationItem = (label, value) => {
                    if (value) {
                        html += `
                            <li class="border-b pb-2">
                                <div class="flex justify-between items-center">
                                    <p class="font-bold">${label}:</p>
                                    <p>${value}</p>
                                </div>
                            </li>
                        `;
                    }
                };

                appendConfirmationItem('お名前', data['name']);
                appendConfirmationItem('ふりがな', data['furigana']);
                appendConfirmationItem('生年月日', `${data['birthYear'] || ''}年 ${data['birthMonth'] || ''}月 ${data['birthDay'] || ''}日`);
                appendConfirmationItem('性別', data['genderOtherText'] || data['gender']);
                appendConfirmationItem('都道府県', data['prefecture']);
                appendConfirmationItem('市町村', data['city']);
                appendConfirmationItem('旧姓', data['maidenName']);

                if (data['家族構成'] && data['家族構成'].length > 0) {
                    html += `<li class="border-b pb-2"><p class="font-bold">同居のご家族構成と年齢:</p><ul>`;
                    data['家族構成'].forEach(family => {
                        html += `<li>- 関係性: ${family['関係性'] || ''}, 年齢: ${family['年齢'] || ''}</li>`;
                    });
                    html += `</ul></li>`;
                }

                appendConfirmationItem('職務内容', data['jobTitle']);
                appendConfirmationItem('紹介者', data['introducer']);
                appendConfirmationItem('お知りになったきっかけ', data['trigger']);

                html += '</ul>';

                confirmationDisplay.innerHTML = html;
            }

            // バリデーションチェック関数
            function validateForm() {
                let isValid = true;
                let firstInvalidElement = null;
                formElements.forEach(el => {
                    el.classList.remove('input-error');
                });

                form.querySelectorAll('[required]').forEach(el => {
                    if (el.checkValidity() === false || (el.type === 'radio' && !form.querySelector(`input[name="${el.name}"]:checked`))) {
                        el.classList.add('input-error');
                        isValid = false;
                        if (!firstInvalidElement) {
                            firstInvalidElement = el;
                        }
                    }
                });

                return { isValid, firstInvalidElement };
            }

            // フォーム送信イベント
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const { isValid, firstInvalidElement } = validateForm();

                if (!isValid) {
                    errorMessage.innerText = "必須項目を入力してください。";
                    errorModal.style.display = 'flex';
                    if (firstInvalidElement) {
                        firstInvalidElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                    return;
                }

                // GAS URLが設定されているかチェック
                if (GAS_URL === "YOUR_GOOGLE_APPS_SCRIPT_URL_HERE") {
                    errorMessage.innerText = "Google Apps ScriptのURLが設定されていません。コード内のGAS_URLを正しいURLに置き換えてください。";
                    errorModal.style.display = 'flex';
                    return;
                }
                
                // フォームデータを取得し、GASへ送信
                const formData = new FormData(form);
                const data = {};
                
                // フォームデータをオブジェクトに整形
                for (let [key, value] of formData.entries()) {
                    if (key.includes('familyRelation') || key.includes('familyAge')) {
                        // 家族構成は配列に整形
                        const familyData = data.familyMembers || [];
                        const index = key.includes('Relation') ? Array.from(form.querySelectorAll('input[name="familyRelation[]"]')).indexOf(form.querySelector(`input[name="familyRelation[]"][value="${value}"]`)) : Array.from(form.querySelectorAll('input[name="familyAge[]"]')).indexOf(form.querySelector(`input[name="familyAge[]"][value="${value}"]`));
                        
                        if (!familyData[index]) {
                            familyData[index] = {};
                        }
                        if (key.includes('Relation')) {
                            familyData[index].relation = value;
                        } else {
                            familyData[index].age = value;
                        }
                        data.familyMembers = familyData;
                    } else {
                        data[key] = value;
                    }
                }

                // 性別が「その他」の場合の処理
                if (formData.get('genderOtherText')) {
                    data.gender = formData.get('genderOtherText');
                } else {
                    data.gender = formData.get('gender');
                }

                try {
                    submitButton.disabled = true;
                    submitButton.innerText = '送信中...';
                    const response = await fetch(GAS_URL, {
                        method: 'POST',
                        mode: 'no-cors', // クロスオリジン問題を回避するため
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data),
                    });

                    // no-corsモードのため、レスポンスのチェックはできません。
                    // 成功したと仮定して処理を進めます。
                    alert('送信が完了しました。ご入力ありがとうございます。');
                    form.reset();
                    updateConfirmationDisplay();
                    document.getElementById('genderOtherText').classList.add('hidden');
                    // 家族構成を初期状態に戻す
                    familyMembersContainer.innerHTML = `
                        <div class="flex gap-2 items-end">
                            <div class="flex-1">
                                <label class="block text-sm text-gray-500">関係性</label>
                                <input type="text" name="familyRelation[]" placeholder="例：夫" class="w-full px-4 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:border-main-button-color">
                            </div>
                            <div class="flex-1">
                                <label class="block text-sm text-gray-500">年齢</label>
                                <input type="text" name="familyAge[]" class="w-full px-4 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:border-main-button-color">
                            </div>
                            <button type="button" class="clear-button w-8 h-8 rounded-full font-bold text-lg leading-none flex items-center justify-center opacity-0 transition-opacity" aria-label="家族をクリア">×</button>
                        </div>
                    `;

                } catch (error) {
                    errorMessage.innerText = '送信中にエラーが発生しました。時間をおいて再度お試しください。';
                    errorModal.style.display = 'flex';
                    console.error('Error submitting form:', error);
                } finally {
                    submitButton.disabled = false;
                    submitButton.innerText = '送信';
                }
            });

            // エラーモーダルを閉じる
            closeModalButton.addEventListener('click', () => {
                errorModal.style.display = 'none';
            });
        });
    </script>

</body>
</html>
